# Redis Integration –¥–ª—è NEXTADMIN

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Redis Integration

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–æ–¥—É–∫—Ç—ã**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤  
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ Telegram ID
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞
- **–ó–∞–∫–∞–∑—ã**: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- **–°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–æ—Ç–∞ (–∑–∞–º–µ–Ω–∞ Map)

### 2. –û—á–µ—Ä–µ–¥–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ**: –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ 48 –∏ 72 —á–∞—Å–∞
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–æ–Ω—É—Å–∞—Ö**: Async —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–æ–Ω—É—Å–æ–≤
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –Ω–∞–ª–∏—á–∏–µ
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞**: Async –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—á–µ—Ç—á–∏–∫–∏
- **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤**: –°—á–µ—Ç—á–∏–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤**: –°—á–µ—Ç—á–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤

## üì¶ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Upstash Redis (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
UPSTASH_REDIS_REST_URL=https://your-redis-url.upstash.io
UPSTASH_REDIS_REST_TOKEN=your-upstash-token
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ Upstash Redis (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Upstash](https://upstash.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Redis –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ REST URL –∏ TOKEN
4. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### CacheService

```typescript
import { CacheService } from '@/lib/services/cache.service';

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
const products = await CacheService.getProducts({
  showInWebapp: true,
  limit: 20
});

// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = await CacheService.getUserByTelegramId('123456789');

// –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
await CacheService.clearProductsCache();
```

### RedisQueueService

```typescript
import { RedisQueueService } from '@/lib/services/redis-queue.service';

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 48 —á–∞—Å–æ–≤
await RedisQueueService.addNotification('payment_reminder', {
  orderId: 123,
  reminderType: 'first'
}, 48 * 60 * 60);

// –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏
await RedisQueueService.startWorker();
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### API —ç–Ω–¥–ø–æ–∏–Ω—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Redis
GET /api/redis/status

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–º
POST /api/redis/status
{"action": "start_worker"}
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è
- **–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤**: 200ms ‚Üí 20ms
- **–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: 150ms ‚Üí 10ms  
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞**: 100ms ‚Üí 5ms
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å

## üõ°Ô∏è –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å fallback –ª–æ–≥–∏–∫–æ–π - –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é.

## üîß –ö–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:3000/api/redis/status

# –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞
curl -X POST http://localhost:3000/api/redis/status \
  -H "Content-Type: application/json" \
  -d '{"action": "start_worker"}'
```

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

Redis –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

1. **TelegramBotWorker** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞** - –∫—ç—à–∏—Ä—É—é—Ç—Å—è —Å TTL 10 –º–∏–Ω—É—Ç  
3. **Queue Worker** - –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ Redis
4. **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CacheService –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è

Redis –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç —Ä–∞–±–æ—Ç—É –≤–∞—à–µ–≥–æ Telegram WebApp! üöÄ 