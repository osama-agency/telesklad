# Исправление черного фона у изображений товаров

## Проблема
При загрузке PNG изображений с прозрачным фоном через админку, после конвертации в JPEG прозрачные области становились черными.

## Причина
Sharp (библиотека для обработки изображений) по умолчанию заменяет прозрачные пиксели на черный цвет при конвертации в формат JPEG, который не поддерживает прозрачность.

## Решение
Добавлен метод `.flatten()` с белым фоном перед конвертацией в JPEG:

```javascript
.flatten({ 
  background: { r: 255, g: 255, b: 255 } // Белый фон для прозрачности
})
```

## Что делать с уже загруженными изображениями
Для товаров с черным фоном нужно:
1. Перезагрузить изображение через админку
2. Очистить кэш Redis: `redis-cli FLUSHALL`
3. Обновить страницу в WebApp

## Технические детали
- Файл: `/src/app/api/upload/image/route.ts`
- Все PNG изображения теперь конвертируются в JPEG с белым фоном
- Размер оптимизирован до 800x800px
- Качество JPEG: 85%

## Дата исправления
27 июня 2025