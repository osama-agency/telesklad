# Загрузка изображений товаров в S3

## Подготовка

1. **Создайте папку для изображений:**
   ```bash
   mkdir temp-images
   ```

2. **Поместите все изображения товаров в папку `temp-images/`**
   - Поддерживаемые форматы: `.jpg`, `.jpeg`, `.png`, `.webp`, `.gif`
   - Рекомендуемое именование файлов: `название-товара-дозировка.jpg`
   - Примеры: `abilify-30mg.jpg`, `attex-40mg.webp`, `atominex-18mg.png`

3. **Настройте переменные окружения S3:**
   Создайте файл `.env.local` с настройками:
   ```env
   S3_ACCESS_KEY=ваш_access_key
   S3_SECRET_KEY=ваш_secret_key
   S3_BUCKET=2c11548b454d-eldar-agency
   S3_ENDPOINT=https://s3.ru1.storage.beget.cloud
   S3_REGION=ru-1
   ```

## Запуск загрузки

### Вариант 1: Загрузка реальных изображений
```bash
npm run upload:images
```

### Вариант 2: Ручной запуск
```bash
node scripts/upload-real-images.js
```

## Что происходит

1. **Сканирование папки:** Скрипт находит все изображения в `temp-images/`
2. **Сопоставление:** Для каждого товара ищется подходящее изображение по названию
3. **Загрузка в S3:** Изображения загружаются в Beget Cloud Storage
4. **Обновление БД:** В базе данных обновляется поле `image_url`

## Алгоритм сопоставления

Скрипт ищет изображения по следующим правилам:

1. **Точное совпадение:** `abilify-30mg.jpg` → `Abilify 30 mg`
2. **Ключевые слова:** `attex.jpg` → любой товар содержащий "attex"
3. **Нормализация:** пробелы заменяются на дефисы, скобки удаляются

## Примеры именования файлов

| Товар в БД | Подходящие имена файлов |
|------------|------------------------|
| `Abilify 30 mg` | `abilify-30mg.jpg`, `abilify30.png` |
| `Attex 40 mg` | `attex-40mg.webp`, `attex40.jpg` |
| `Atominex 18 mg` | `atominex-18mg.png`, `atominex18.jpg` |
| `Мирена 20 мкг/24 часа` | `mirena.jpg`, `мирена.png` |

## Проверка результатов

После загрузки проверьте:

1. **Консоль:** Посмотрите отчет о загрузке
2. **База данных:** Проверьте поле `image_url` в таблице `products`
3. **Каталог:** Обновите страницу каталога для просмотра изображений

## Команды для проверки

```bash
# Проверить статистику изображений
node scripts/check-images.js

# Открыть Prisma Studio для просмотра БД
npm run prisma:studio
```

## Устранение проблем

### Ошибка S3 аутентификации
- Проверьте правильность `S3_ACCESS_KEY` и `S3_SECRET_KEY`
- Убедитесь что ключи имеют права на запись в bucket

### Изображения не найдены
- Проверьте что файлы находятся в папке `temp-images/`
- Убедитесь что имена файлов соответствуют товарам
- Используйте поддерживаемые форматы (jpg, png, webp)

### Товары не обновляются
- Проверьте подключение к базе данных
- Убедитесь что переменная `DATABASE_URL` настроена правильно

## Очистка

После успешной загрузки можете удалить временную папку:
```bash
rm -rf temp-images/
```

## Безопасность

⚠️ **Важно:** Не коммитьте файл `.env.local` с ключами доступа в Git! 