# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ TGAPP

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: "–∞–Ω–∏–º–∞—Ü–∏—è –∫–∞–∫–∞—è-—Ç–æ –≤–∏—Å–Ω–µ—Ç –Ω–∞–∂–∏–º–∞—é –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ –∏ –æ–Ω–æ –Ω–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º —Å—Ä–∞–∑—É".

–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—É—Ç–∏ `/tgapp/*` –≤–º–µ—Å—Ç–æ `/webapp/*`, –∑–Ω–∞—á–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ `tgapp`.

## –ê–Ω–∞–ª–∏–∑
–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
- `GET /tgapp/catalog 200 in 104ms` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tgapp
- `‚úÖ Returning 2 favorites for user 12` - API —Ä–∞–±–æ—Ç–∞–µ—Ç  
- `isAuthenticated: false` - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
**–§–∞–π–ª:** `src/app/tgapp/_components/FavoriteButton.tsx`

### ‚ö° –ò–∑–º–µ–Ω–µ–Ω–∏—è:

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
```typescript
const [optimisticFavoriteState, setOptimisticFavoriteState] = useState<boolean | null>(null);

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
const isFavorite = optimisticFavoriteState !== null ? optimisticFavoriteState : favoriteIds.includes(productId);
```

#### 2. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
```typescript
const handleToggleFavorite = async (e: React.MouseEvent) => {
  e.preventDefault();
  e.stopPropagation();
  
  const newIsFavorite = !isFavorite;
  
  // üöÄ –û–ü–¢–ò–ú–ò–°–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï - –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  setOptimisticFavoriteState(newIsFavorite);
  triggerHaptic(newIsFavorite ? "medium" : "light");
  
  // –î–∞–ª–µ–µ API –∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ–Ω–µ...
}
```

#### 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
```typescript
useEffect(() => {
  if (optimisticFavoriteState === null) {
    return; // –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º
  const realIsFavorite = favoriteIds.includes(productId);
  if (optimisticFavoriteState === realIsFavorite) {
    // –°–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç, –º–æ–∂–µ–º —Å–±—Ä–æ—Å–∏—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ
    setOptimisticFavoriteState(null);
  }
}, [favoriteIds, productId, optimisticFavoriteState]);
```

#### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```typescript
try {
  await contextToggleFavorite(productId);
  // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  setOptimisticFavoriteState(null);
} catch (error) {
  // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
  setOptimisticFavoriteState(!newIsFavorite);
}
```

#### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã Telegram WebApp
–ó–∞–º–µ–Ω–µ–Ω—ã –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `window.Telegram.WebApp` –Ω–∞ `(window as any).Telegram.WebApp` –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ—à–∏–±–æ–∫ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å
- –°–µ—Ä–¥–µ—á–∫–æ –∫—Ä–∞—Å–Ω–µ–µ—Ç **—Å—Ä–∞–∑—É** –ø—Ä–∏ –∫–ª–∏–∫–µ
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ API –æ—Ç–≤–µ—Ç–∞
- –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –±–µ–∑ "–∑–∞–≤–∏—Å–∞–Ω–∏—è"

### üîÑ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å  
- –ü—Ä–∏ –æ—à–∏–±–∫–µ API —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- Haptic feedback —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üéØ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–æ–∫ (sm, md, lg)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–∫–∞–∑ —Å—á–µ—Ç—á–∏–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è** - —Å–µ—Ä–¥–µ—á–∫–æ –∫—Ä–∞—Å–Ω–µ–µ—Ç —Å—Ä–∞–∑—É
- ‚úÖ **–ù–µ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è** - UI –æ—Ç–∑—ã–≤—á–∏–≤ –ø—Ä–∏ –ª—é–±–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–µ—Ç–∏
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∏–∫–∏**: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
2. **–ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º  
3. **–û—à–∏–±–∫–∏ —Å–µ—Ç–∏**: –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
4. **–ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏**: –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è

–¢–µ–ø–µ—Ä—å –∞–Ω–∏–º–∞—Ü–∏—è –≤ `/tgapp/catalog` —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ! üéâ

## –û—Ç–ª–∏—á–∏—è –æ—Ç /webapp –≤–µ—Ä—Å–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `useFavorites()` –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö API –≤—ã–∑–æ–≤–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Telegram WebApp API –¥–ª—è haptic feedback
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∫–Ω–æ–ø–æ–∫
- –ò–º–µ–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ 