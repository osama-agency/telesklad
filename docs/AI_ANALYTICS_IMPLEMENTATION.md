# üß† –ò–ò-–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ê—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–∞ - –ü–æ–ª–Ω–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **API Endpoint** (`/api/analytics/ai`)
- **–ú–∞—Ä—à—Ä—É—Ç**: `src/app/api/analytics/ai/route.ts`
- **–ú–µ—Ç–æ–¥**: GET
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `?from=2025-01-01&to=2025-01-31`
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. **–ò–ò –°–µ—Ä–≤–∏—Å** (`src/lib/services/ai.service.ts`)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT-4
- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
- –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–æ–≤
- Fallback –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 3. **UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç** (`src/components/ai/AssortmentAnalysis.tsx`)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ –¥–∞—Ç
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≥–Ω–æ–∑—ã –ø—Ä–æ–¥–∞–∂
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`)
```env
# OpenAI API Key
OPENAI_API_KEY=sk-proj-v4bKzJ4b-...
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- OpenAI API (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π fetch)
- Prisma (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- NextAuth (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)

## üìä –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Prisma:
1. **–¢–æ–≤–∞—Ä—ã** (`Product`):
   - `name`, `price`, `prime_cost`, `avgPurchasePriceRub`
   - `stock_quantity`, `brand`, `is_visible`

2. **–ó–∞–∫–∞–∑—ã** (`Order` + `OrderItem`):
   - –¢–æ–ª—å–∫–æ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ (`paidAt !== null`)
   - –ó–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
   - –ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º

3. **ABC/XYZ –∞–Ω–∞–ª–∏–∑**:
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—ã—Ä—É—á–∫–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
   - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏

### –§–æ—Ä–º–∏—Ä—É–µ–º—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã:
- **–£–±—ã—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã**: `profit < 0`
- **–¢–æ–ø —Ç–æ–≤–∞—Ä—ã**: –ø–æ –≤—ã—Ä—É—á–∫–µ (—Ç–æ–ø-5)
- **–ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏**: `stock < 10` + –ø—Ä–æ–¥–∞–≤–∞–ª–∏—Å—å
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –≤—ã—Ä—É—á–∫–∞, —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å, –ø—Ä–∏–±—ã–ª—å, –º–∞—Ä–∂–∞

## ü§ñ OpenAI –ü—Ä–æ–º–ø—Ç

```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥ 01 - 15 –∏—é–Ω—è.

–ò—Å–ø–æ–ª—å–∑—É–π ABC/XYZ-–≥—Ä—É–ø–ø—ã, –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å, –æ—Å—Ç–∞—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏. –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π:

1. 3-5 –∫–ª—é—á–µ–≤—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–∫—Ç–æ–≤ (–∫—Ä–∞—Ç–∫–æ, —Ü–∏—Ñ—Ä—ã)
2. 2-3 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∑–∞–∫—É–ø–∫–µ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è)
3. –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂ –Ω–∞ 30/60/90 –¥–Ω–µ–π

–î–∞–Ω–Ω—ã–µ:
ABC/XYZ –º–∞—Ç—Ä–∏—Ü–∞: {...}
–£–±—ã—Ç–æ—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã: [...]
–¢–æ–ø —Ç–æ–≤–∞—Ä—ã: [...]
–ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏: [...]
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {...}
```

## üì§ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

```json
{
  "success": true,
  "data": {
    "analysis": {
      "facts": [
        "72% –≤—ã—Ä—É—á–∫–∏ –ø—Ä–∏–Ω–æ—Å—è—Ç 4 —Ç–æ–≤–∞—Ä–∞",
        "5 —Ç–æ–≤–∞—Ä–æ–≤ —É–±—ã—Ç–æ—á–Ω—ã (‚Äì11 420 ‚ÇΩ)",
        "23 —Ç–æ–≤–∞—Ä–∞ —Ç—Ä–µ–±—É—é—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è"
      ],
      "recommendations": [
        "–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–∫—É–ø Strattera 10mg",
        "–ò—Å–∫–ª—é—á–∏—Ç—å Wellbutrin",
        "–°–Ω–∏–∑–∏—Ç—å —Ü–µ–Ω—É –Ω–∞ Atominex 25mg"
      ],
      "forecasts": {
        "days30": "–û–∂–∏–¥–∞–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ–¥–∞–∂ –Ω–∞ 5-8%",
        "days60": "–í–æ–∑–º–æ–∂–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ 2-3%",
        "days90": "–í–æ–∑–≤—Ä–∞—Ç –∫ —Å—Ä–µ–¥–Ω–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º"
      }
    },
    "rawData": {
      "totalProducts": 152,
      "period": {...},
      "abcxyzMatrix": {...},
      "statistics": {...}
    }
  }
}
```

## üéØ UI –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `AssortmentAnalysis`:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏—è: –∑–∞–≥—Ä—É–∑–∫–∞, –æ—à–∏–±–∫–∞, –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Fallback –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–±–æ–µ –ò–ò
- ‚úÖ –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ë–ª–æ–∫ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –ø—Ä–æ–¥–∞–∂
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –≤ —Å—Ç–∏–ª–µ Aviasales

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- –ó–∞–º–µ–Ω—è–µ—Ç –±–ª–æ–∫ —Å 4 –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –º–µ—Ç—Ä–∏–∫
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `useDateRange` –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–µ—Ä–∏–æ–¥–∞

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### API —É—Ä–æ–≤–µ–Ω—å:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç
- Fallback –ø—Ä–∏ —Å–±–æ–µ OpenAI
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

### UI —É—Ä–æ–≤–µ–Ω—å:
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- Graceful degradation

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–æ–≤** (`/products`)
2. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–µ—Ä–∏–æ–¥** –≤ date picker
3. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç –ò–ò-–∞–Ω–∞–ª–∏–∑**
4. **–ü–æ–ª—É—á–∏—Ç–µ –∂–∏–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –æ—Ç GPT-4

### –†—É—á–Ω–æ–π –∑–∞–ø—Ä–æ—Å:
```bash
GET /api/analytics/ai?from=2025-01-01T00:00:00.000Z&to=2025-01-31T23:59:59.999Z
```

## üí° –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤** –ò–ò (Redis/–ø–∞–º—è—Ç—å)
2. **–†–∞–∑–ª–∏—á–Ω—ã–µ –º–æ–¥–µ–ª–∏** (GPT-3.5, Claude)
3. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤** –ø–æ —Ä–æ–ª—è–º
4. **–≠–∫—Å–ø–æ—Ä—Ç –∞–Ω–∞–ª–∏–∑–∞** –≤ PDF/Excel
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
6. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```
ü§ñ AI Analytics: Collecting data from database...
ü§ñ AI Analytics: Sending data to OpenAI...  
ü§ñ AI Analytics: Analysis completed successfully
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:
- –û—Ç–∫—Ä–æ–π—Ç–µ Network –≤ DevTools
- –°–º–µ–Ω–∏—Ç–µ –¥–∞—Ç—ã –≤ date picker
- –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/analytics/ai` 