# Добавление формы "Данные для доставки" в корзину

## Что было добавлено

### 1. Новый компонент `DeliveryForm` 

**Файл:** `src/app/webapp/_components/DeliveryForm.tsx`

**Возможности:**
- ✅ Форма для ввода данных доставки (город, улица, дом, квартира, корпус, индекс)
- ✅ Поля личной информации (ФИО, телефон) - опционально
- ✅ Автоматическое форматирование телефона
- ✅ Валидация обязательных полей
- ✅ Callback для передачи данных в родительский компонент
- ✅ Предзаполнение из переданных данных

**Интерфейс:**
```typescript
interface DeliveryData {
  address: string;        // Город
  street: string;         // Улица
  home: string;          // Дом
  apartment: string;      // Квартира (необязательно)
  build: string;         // Корпус (необязательно)
  postal_code: number;   // Почтовый индекс
  first_name: string;    // Имя
  last_name: string;     // Отчество
  middle_name: string;   // Фамилия
  phone_number: string;  // Телефон
}
```

### 2. Обновлена страница корзины

**Файл:** `src/app/webapp/cart/page.tsx`

**Новые функции:**
- ✅ Загрузка профиля пользователя для предзаполнения формы
- ✅ Автоматическое сохранение данных доставки в localStorage
- ✅ Валидация: кнопка "Оформить заказ" активна только при заполненных обязательных полях
- ✅ Интеграция с существующей системой корзины

**Обязательные поля для оформления заказа:**
- Город (address)
- Улица (street)  
- Дом (home)
- Имя (first_name)
- Телефон (phone_number)

### 3. Добавлены стили

**Файл:** `src/styles/webapp.scss`

**Новые стили:**
- ✅ `.delivery-form` - основной контейнер формы
- ✅ `.input-container` - контейнер для полей ввода  
- ✅ Стили для input полей с focus эффектами
- ✅ Стили для отключенной кнопки заказа
- ✅ Адаптивные размеры шрифтов

## Как это работает

### Пользовательский опыт:

1. **Пользователь открывает корзину** `/webapp/cart`
2. **Видит список товаров** (как и раньше)
3. **Под товарами видит форму доставки**:
   - Если есть профиль - поля предзаполнены
   - Если нет - пустая форма
4. **Заполняет данные доставки**
5. **Кнопка "Оформить заказ" активируется** только при заполнении обязательных полей
6. **Данные сохраняются** в localStorage для следующих заказов

### Техническая реализация:

1. **При загрузке страницы:**
   ```typescript
   // Загружаем профиль пользователя
   const response = await fetch('/api/webapp/profile');
   
   // Предзаполняем форму данными из профиля
   setDeliveryData({
     address: user.address || '',
     street: user.street || '',
     // ... остальные поля
   });
   ```

2. **При изменении данных:**
   ```typescript
   const handleDeliveryDataChange = (data: DeliveryData) => {
     setDeliveryData(data);
     // Сохраняем в localStorage
     localStorage.setItem('webapp_delivery_data', JSON.stringify(data));
   };
   ```

3. **Валидация кнопки заказа:**
   ```typescript
   disabled={!deliveryData || 
            !deliveryData.address || 
            !deliveryData.street || 
            !deliveryData.home || 
            !deliveryData.first_name || 
            !deliveryData.phone_number}
   ```

## Структура формы

### Личная информация (если showPersonalInfo=true):
- **Фамилия** - обязательное поле, min 2 символа
- **Имя** - обязательное поле, min 2 символа  
- **Отчество** - обязательное поле, min 2 символа
- **Телефон** - обязательное, автоформатирование `+7 (999) 123-45-67`

### Адрес доставки:
- **Город** - обязательное поле
- **Улица** - обязательное поле
- **Дом/Квартира** - две колонки, дом обязательный
- **Корпус/Индекс** - две колонки, индекс обязательный (6 цифр)

## Файлы изменены

- ✅ `src/app/webapp/_components/DeliveryForm.tsx` - новый компонент
- ✅ `src/app/webapp/cart/page.tsx` - добавлена форма доставки
- ✅ `src/styles/webapp.scss` - добавлены стили формы

## Тестирование

1. Перейти на `/webapp/cart`
2. Добавить товары в корзину
3. Проверить:
   - ✅ Форма доставки отображается под товарами
   - ✅ Поля предзаполняются из профиля (если есть)
   - ✅ Кнопка "Оформить заказ" неактивна до заполнения обязательных полей
   - ✅ Данные сохраняются в localStorage
   - ✅ Форматирование телефона работает
   - ✅ Валидация полей работает

## Следующие шаги

Для полной функциональности потребуется:
- [ ] API для создания заказа с данными доставки
- [ ] Интеграция с платежной системой
- [ ] Email уведомления о заказе 