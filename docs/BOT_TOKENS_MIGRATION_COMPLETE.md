# –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –±–æ—Ç–æ–≤ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## –î–∞—Ç–∞: 2025-06-25

## –¶–µ–ª—å
–†–∞–∑–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:
- **@strattera_bot** –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ Rails API (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º)
- **CLIENT_BOT_TOKEN** (7754514670) - –¥–ª—è WebApp –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- **ADMIN_BOT_TOKEN** (7612206140) - –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫—É—Ä—å–µ—Ä—É –∏ –∞–¥–º–∏–Ω—É

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `settings_bot`:**
```sql
-- –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Å—Ç–æ–ª–±—Ü—ã
ALTER TABLE settings_bot DROP COLUMN IF EXISTS primary_bot_token;
ALTER TABLE settings_bot DROP COLUMN IF EXISTS test_bot_token;
ALTER TABLE settings_bot DROP COLUMN IF EXISTS admin_bot_token;

-- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã
ALTER TABLE settings_bot ADD COLUMN CLIENT_BOT_TOKEN VARCHAR(100);
ALTER TABLE settings_bot ADD COLUMN ADMIN_BOT_TOKEN VARCHAR(100);
```

**–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã:**
```sql
UPDATE settings_bot SET 
    CLIENT_BOT_TOKEN = '7754514670:AAFswWZxch4OwaLcmQp7LMzr6E3AdJ5woPg',
    ADMIN_BOT_TOKEN = '7612206140:AAHA6sV7VZLyUu0Ua1DAoULiFYehAkAjJK4'
WHERE id = 1;
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Prisma —Å—Ö–µ–º—ã

```prisma
model settings_bot {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–æ–≤
  environment                 String   @default("development") @db.VarChar(20)
  CLIENT_BOT_TOKEN           String?  @db.VarChar(100) // –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –±–æ—Ç –¥–ª—è WebApp –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  ADMIN_BOT_TOKEN            String?  @db.VarChar(100) // –ê–¥–º–∏–Ω—Å–∫–∏–π –±–æ—Ç –¥–ª—è –∫—É—Ä—å–µ—Ä–∞ –∏ –∞–¥–º–∏–Ω–∞
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã settings (–≤—Ä–µ–º–µ–Ω–Ω–æ)

–î–æ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã –≤ —Å—Ç–∞—Ä–æ–π —Ç–∞–±–ª–∏—Ü–µ:
```sql
UPDATE settings SET value = '7754514670:AAFswWZxch4OwaLcmQp7LMzr6E3AdJ5woPg' 
WHERE variable = 'webapp_telegram_bot_token';
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TelegramTokenService

–û–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å `settings_bot`.

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–æ–≤:

1. **@strattera_bot (7097447176)** - Rails API
   - ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Next.js
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º Rails —Å–µ—Ä–≤–µ—Ä–µ
   - ‚úÖ Webhook –æ—Ç–∫–ª—é—á–µ–Ω –æ—Ç Next.js

2. **CLIENT_BOT (7754514670)** - Next.js Grammy
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è WebApp
   - ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º
   - ‚úÖ Simple Grammy webhook —Ä–∞–±–æ—Ç–∞–µ—Ç: `/api/telegram/grammy-simple/webhook`

3. **ADMIN_BOT (7612206140)** - Next.js –¥–ª—è –∞–¥–º–∏–Ω–∞
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω—É –æ–± –æ–ø–ª–∞—Ç–∞—Ö
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä—É –æ –∑–∞–∫–∞–∑–∞—Ö
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Prisma —Å—Ö–µ–º–∞: –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ Simple Grammy webhook: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è –û—Å–Ω–æ–≤–Ω–æ–π Grammy webhook: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- ‚ö†Ô∏è TypeScript: –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å settings_bot (–Ω—É–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (—Å–µ–≥–æ–¥–Ω—è):
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å TypeScript —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏
2. **–û–±–Ω–æ–≤–∏—Ç—å TelegramTokenService** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è settings_bot
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π Grammy webhook** (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞)
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook –¥–ª—è CLIENT_BOT** –Ω–∞ grammy-simple endpoint

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è):
1. **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ settings_bot** –º–æ–¥–µ–ª—å
2. **–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–∞–º–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:
1. **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Ç–∞–±–ª–∏—Ü—ã settings** (—Ç–æ–∫–µ–Ω—ã)
2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è webhook'–æ–≤** 
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–æ–≤**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ Grammy webhook
curl -X GET https://strattera.ngrok.app/api/telegram/grammy-simple/webhook

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤ (–±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)
curl -X GET https://strattera.ngrok.app/api/telegram/bot-status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
psql $DATABASE_URL -c "SELECT environment, CLIENT_BOT_TOKEN, ADMIN_BOT_TOKEN FROM settings_bot WHERE id = 1;"
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- Simple Grammy webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "active"
- CLIENT_BOT_TOKEN –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- ADMIN_BOT_TOKEN –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–æ–≤ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   @strattera_bot ‚îÇ    ‚îÇ   CLIENT_BOT     ‚îÇ    ‚îÇ   ADMIN_BOT     ‚îÇ
‚îÇ   (Rails API)   ‚îÇ    ‚îÇ   (Next.js)      ‚îÇ    ‚îÇ   (Next.js)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ –ü—Ä–æ–¥–∞–∫—à–Ω      ‚îÇ    ‚îÇ ‚Ä¢ WebApp         ‚îÇ    ‚îÇ ‚Ä¢ –ê–¥–º–∏–Ω         ‚îÇ
‚îÇ ‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã–µ      ‚îÇ    ‚îÇ ‚Ä¢ –ö–ª–∏–µ–Ω—Ç—ã        ‚îÇ    ‚îÇ ‚Ä¢ –ö—É—Ä—å–µ—Ä        ‚îÇ
‚îÇ   –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  ‚îÇ    ‚îÇ ‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    ‚îÇ    ‚îÇ ‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è   ‚îÇ
‚îÇ ‚Ä¢ Rails —Å–µ—Ä–≤–µ—Ä  ‚îÇ    ‚îÇ ‚Ä¢ Grammy         ‚îÇ    ‚îÇ ‚Ä¢ Grammy        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ fallback
- Simple Grammy webhook —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- TypeScript —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ Grammy webhook 