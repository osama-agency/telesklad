# üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Amazon S3 –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```env
# AWS S3 Configuration
AWS_ACCESS_KEY_ID="your-aws-access-key-id"
AWS_SECRET_ACCESS_KEY="your-aws-secret-access-key"
AWS_REGION="us-east-1"
S3_BUCKET_NAME="nextadmin-products"
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AWS S3

### 1. –°–æ–∑–¥–∞–Ω–∏–µ S3 Bucket

1. –í–æ–π–¥–∏—Ç–µ –≤ [AWS Console](https://console.aws.amazon.com/)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ S3
3. –ù–∞–∂–º–∏—Ç–µ "Create bucket"
4. –£–∫–∞–∂–∏—Ç–µ –∏–º—è bucket (–Ω–∞–ø—Ä–∏–º–µ—Ä: `nextadmin-products`)
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `us-east-1`)
6. **–í–∞–∂–Ω–æ**: –û—Ç–∫–ª—é—á–∏—Ç–µ "Block all public access" –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
7. –°–æ–∑–¥–∞–π—Ç–µ bucket

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö bucket –¥–æ–±–∞–≤—å—Ç–µ CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```json
[
    {
        "AllowedHeaders": ["*"],
        "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
        "AllowedOrigins": ["*"],
        "ExposeHeaders": []
    }
]
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ IAM –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ IAM
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:PutObject",
                "s3:PutObjectAcl",
                "s3:GetObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::nextadmin-products/*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": "arn:aws:s3:::nextadmin-products"
        }
    ]
}
```

4. –ü–æ–ª—É—á–∏—Ç–µ Access Key ID –∏ Secret Access Key

## üîÑ –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –∑–∞–≥—Ä—É–∑–∫–∏

### 1. –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (—á–µ—Ä–µ–∑ API)
- **Endpoint**: `/api/upload/image`
- **–ú–µ—Ç–æ–¥**: POST
- **–¢–∏–ø**: multipart/form-data
- **–ü–æ–ª–µ**: `file`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ JPEG
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–æ 800x800px

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (Presigned URL)
- **Endpoint**: `/api/upload/presigned-url`
- **–ú–µ—Ç–æ–¥**: POST
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `fileName`, `contentType`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ S3

```
nextadmin-products/
‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îú‚îÄ‚îÄ 1703123456789-abc123.jpg
‚îÇ   ‚îú‚îÄ‚îÄ 1703123456790-def456.jpg
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ other-folders/
```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```typescript
const formData = new FormData();
formData.append('file', file);

const response = await fetch('/api/upload/image', {
  method: 'POST',
  body: formData,
});

const result = await response.json();
console.log('Image URL:', result.imageUrl);
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ Presigned URL
```typescript
const response = await fetch('/api/upload/presigned-url', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    fileName: 'image.jpg',
    contentType: 'image/jpeg'
  }),
});

const { uploadUrl, fileUrl } = await response.json();
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (5MB)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Bucket –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
2. **CORS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
3. **IAM –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞** –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å S3
4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. AWS credentials –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
3. Bucket —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
4. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
5. IAM –ø—Ä–∞–≤–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í AWS CloudWatch –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ S3
- –†–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- –°—Ç–æ–∏–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è 