# üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –æ—Ç–∑—ã–≤–∞–º

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∫ –æ—Ç–∑—ã–≤–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ Beget Cloud Storage.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üìã **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- **–î–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π** –Ω–∞ –æ—Ç–∑—ã–≤
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:** JPG, JPEG, PNG, WEBP
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** 5MB –Ω–∞ —Ñ–∞–π–ª
- **–ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3** —á–µ—Ä–µ–∑ presigned URLs
- **–ü—Ä–µ–≤—å—é —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º** –ø—Ä–∏ –∫–ª–∏–∫–µ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ**

### üõ† **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** Presigned URLs —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3 –±–µ–∑ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
- **UX:** –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **`PhotoUploader`** - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
   - Drag & Drop –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

2. **`ReviewPhotos`** - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
   - –°–µ—Ç–∫–∞ –º–∏–Ω–∏–∞—Ç—é—Ä
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (ESC)

3. **`ReviewForm`** - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PhotoUploader
   - –û—Ç–ø—Ä–∞–≤–∫–∞ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –æ—Ç–∑—ã–≤–æ–º

### **API Endpoints:**

#### `POST /api/webapp/reviews/upload`
–ü–æ–ª—É—á–µ–Ω–∏–µ presigned URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:

```typescript
// Request
{
  fileName: string,
  contentType: string
}

// Response
{
  success: true,
  uploadUrl: string,  // Presigned URL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
  fileUrl: string     // –§–∏–Ω–∞–ª—å–Ω—ã–π URL —Ñ–∞–π–ª–∞
}
```

#### `POST /api/webapp/products/[id]/reviews`
–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏:

```typescript
// Request
{
  content: string,
  rating: number,
  photos: string[],  // –ú–∞—Å—Å–∏–≤ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
  tg_id: string
}
```

## üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã:**

```sql
-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ photos –≤ —Ç–∞–±–ª–∏—Ü—É reviews
ALTER TABLE reviews 
ADD COLUMN photos TEXT[] DEFAULT '{}';

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º
CREATE INDEX idx_reviews_photos ON reviews USING GIN (photos);
```

### **Prisma Schema:**

```prisma
model reviews {
  id         BigInt   @id @default(autoincrement())
  user_id    BigInt
  product_id BigInt
  content    String?
  rating     Int      @default(0)
  photos     String[] @default([])  // –ù–æ–≤–æ–µ –ø–æ–ª–µ
  created_at DateTime @db.Timestamp(6)
  updated_at DateTime @db.Timestamp(6)
  approved   Boolean  @default(false)
  // ... relations
}
```

## üé® –°—Ç–∏–ª–∏ –∏ UX

### **–î–∏–∑–∞–π–Ω –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **–°–µ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:** 3 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
- **Hover —ç—Ñ—Ñ–µ–∫—Ç—ã:** –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç–µ–Ω–∏
- **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ:** –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏:** –ö—Ä—É–≥–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### **–ê–Ω–∏–º–∞—Ü–∏–∏:**
- `modal-fade-in` - –ü–æ—è–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- `modal-scale-in` - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `bonus-selected-appear` - –ü–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `spin` - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
S3_ENDPOINT=https://s3.ru1.storage.beget.cloud
S3_BUCKET=2c11548b454d-eldar-agency
S3_REGION=ru-1
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –≤ S3:**
```
bucket/
‚îú‚îÄ‚îÄ reviews/
‚îÇ   ‚îú‚îÄ‚îÄ 1703123456789-photo1.jpg
‚îÇ   ‚îú‚îÄ‚îÄ 1703123456790-photo2.png
‚îÇ   ‚îî‚îÄ‚îÄ 1703123456791-photo3.webp
‚îú‚îÄ‚îÄ products/
‚îî‚îÄ‚îÄ avatars/
```

## üì± –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è

### **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã:**
- `@media (max-width: 640px)` - –ú–æ–±–∏–ª—å–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã
- `@media (max-width: 374px)` - –ú–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã

### **–ú–æ–±–∏–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Touch-friendly –∫–Ω–æ–ø–∫–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏

## üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
1. **–¢–∏–ø —Ñ–∞–π–ª–æ–≤:** –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:** –ú–∞–∫—Å–∏–º—É–º 5MB
3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** –î–æ 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
4. **URL –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞ S3
5. **–ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –¢–æ–ª—å–∫–æ –∫—É–ø–∏–≤—à–∏–µ —Ç–æ–≤–∞—Ä

### **Presigned URLs:**
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 1 —á–∞—Å
- –¢–æ–ª—å–∫–æ PUT –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### **–í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –æ—Ç–∑—ã–≤–∞:**

```tsx
import { PhotoUploader } from './PhotoUploader';

function ReviewForm() {
  const [photos, setPhotos] = useState<string[]>([]);

  return (
    <form>
      {/* –î—Ä—É–≥–∏–µ –ø–æ–ª—è */}
      
      <PhotoUploader
        onPhotosChange={setPhotos}
        maxPhotos={3}
        disabled={isSubmitting}
      />
      
      {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ */}
    </form>
  );
}
```

### **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π:**

```tsx
import { ReviewPhotos } from './ReviewPhotos';

function ReviewItem({ review }) {
  return (
    <div className="review">
      <div className="review-content">{review.content}</div>
      <ReviewPhotos photos={review.photos} reviewId={review.id} />
    </div>
  );
}
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ S3 (–±–µ–∑ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä)
- Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ presigned URLs

### **–ú–µ—Ç—Ä–∏–∫–∏:**
- –í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è presigned URL: ~100ms
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ 1MB: ~2-5 —Å–µ–∫
- –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ~300ms

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

### **v1.0.0 - –ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ—Ç–∑—ã–≤–∞—Ö
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### **–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- üîÑ –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- üîÑ Batch –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- üîÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- üîÑ –í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏

## üêõ Troubleshooting

### **–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. **–û—à–∏–±–∫–∞ 403 –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ S3 credentials
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ bucket policy

2. **–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ S3
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ —Ñ–∞–π–ª–∞–º

3. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

### **–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
console.log('Upload URL generated:', uploadUrl);
console.log('File uploaded successfully:', fileUrl);

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
console.log('Review photos:', review.photos);
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** –î–µ–∫–∞–±—Ä—å 2024  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0.0 