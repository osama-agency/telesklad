# TgApp Old Price Feature

## Описание

Добавлено отображение старой цены и процента скидки в карточках товаров каталога.

## Внесенные изменения

### 1. Обновление API

**Файл**: `/src/app/api/webapp/products/route.ts`
- Добавлено поле `old_price` в select запроса к базе данных
- Добавлен возврат `old_price` в ответе API

### 2. Обновление типов

**Файл**: `/src/hooks/useProductsWithSubscriptions.ts`
- Добавлено поле `old_price: number | null` в интерфейс `ProductWithSubscription`

### 3. Обновление компонента карточки товара

**Файл**: `/src/app/tgapp/_components/VirtualProductCatalog.tsx`
- Добавлен расчет скидки: `hasDiscount` и `discountPercent`
- Добавлено отображение старой цены над текущей ценой
- Добавлен бейдж с процентом скидки в левом верхнем углу карточки
- Обновлена функция `areEqual` для учета `old_price` при оптимизации

### 4. Обновление стилей

**Файл**: `/src/app/tgapp/styles/product-card.css`
- Добавлен контейнер `.tgapp-product-price-container` для группировки цен
- Добавлены стили для `.tgapp-product-old-price` (зачеркнутая старая цена)
- Добавлены стили для `.tgapp-product-discount-badge` (красный бейдж с процентом)
- Добавлены адаптивные стили для мобильных устройств

## Визуальные изменения

1. **Старая цена**:
   - Отображается над текущей ценой
   - Серый цвет (`var(--tg-hint-color)`)
   - Зачеркнутый текст
   - Меньший размер шрифта (0.875rem)

2. **Бейдж скидки**:
   - Красный фон (#ef4444 в светлой теме, #dc2626 в темной)
   - Белый текст
   - Расположен в левом верхнем углу карточки
   - Показывает процент скидки (например, "-25%")

3. **Условия отображения**:
   - Старая цена и бейдж показываются только если `old_price > price`
   - Процент скидки округляется до целого числа

## Совместимость

- Изменения полностью обратно совместимы
- Если `old_price` равен null, карточка отображается как раньше
- Темная тема поддерживается полностью