# TG App: Функциональность избранного

## Обзор

Добавлена возможность добавления товаров в избранное в Telegram WebApp. Пользователи могут нажимать на иконку сердечка на карточках товаров для добавления/удаления из избранного.

## Файлы созданы/изменены

### 1. `src/app/tgapp/_components/FavoriteButton.tsx` (новый)
- Компонент кнопки избранного с иконкой сердечка
- Автоматическая проверка статуса избранного при загрузке
- API интеграция для добавления/удаления из избранного
- Виброотклик при взаимодействии
- Анимация загрузки

### 2. `src/app/tgapp/_components/ProductCatalog.tsx` (обновлен)
- Добавлен импорт `FavoriteButton`
- Кнопка избранного размещена в правом верхнем углу каждой карточки товара

## Функциональность

### Визуальные состояния
- **Не в избранном**: Пустое сердечко (только контур)
- **В избранном**: Заполненное красное сердечко
- **Загрузка**: Пульсирующая анимация

### API интеграция
- **GET** `/api/webapp/favorites?tg_id={tg_id}` - получение списка избранного
- **POST** `/api/webapp/favorites` - добавление в избранное
- **DELETE** `/api/webapp/favorites` - удаление из избранного

### Telegram WebApp интеграция
- Получение `tg_id` из `window.Telegram.WebApp.initDataUnsafe.user.id`
- Виброотклик:
  - `light` при удалении из избранного
  - `medium` при добавлении в избранное

### Особенности UX
1. **Автоматическая синхронизация**: При загрузке проверяется статус каждого товара
2. **Мгновенная обратная связь**: Изменение иконки происходит сразу после успешного API запроса
3. **Обработка ошибок**: Логирование ошибок в консоль без блокировки UI
4. **Доступность**: Aria-labels для скринридеров

## CSS стили

Используются существующие стили из `catalog.css`:

```css
.tgapp-favorite-button - базовые стили кнопки
.tgapp-favorite-button.active - стили для активного состояния (красное сердечко)
.tg-dark .tgapp-favorite-button - стили для темной темы
```

## Позиционирование

Кнопка избранного размещается в правом верхнем углу карточки товара с помощью CSS:
- `position: absolute`
- `top: 0.5rem; right: 0.5rem`
- Полупрозрачный фон с blur-эффектом
- Размер: 32x32px

## Совместимость

- ✅ Светлая тема Telegram
- ✅ Тёмная тема Telegram
- ✅ Мобильные устройства
- ✅ Планшеты
- ✅ Виброотклик
- ✅ Анимации и переходы

## Тестирование

Для тестирования функциональности:

1. Открыть https://strattera.ngrok.app/tgapp/catalog
2. Нажать на иконку сердечка на любом товаре
3. Проверить изменение состояния (пустое → заполненное)
4. Проверить виброотклик
5. Обновить страницу и убедиться, что состояние сохранилось
6. Перейти в `/tgapp/favorites` и проверить отображение избранных товаров

## Интеграция с существующей системой

Функциональность полностью интегрирована с существующим API избранного:
- Использует те же эндпоинты, что и старый `/webapp`
- Совместима с существующей базой данных
- Поддерживает аутентификацию через Telegram ID

Дата: 2025-01-29
Автор: AI Assistant 