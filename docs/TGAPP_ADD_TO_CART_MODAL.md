# TG App: Модальное окно выбора количества товара

## Обзор изменений

Обновлен компонент `AddToCartButton` в Telegram WebApp для улучшения пользовательского опыта. Теперь вместо постоянно видимого селектора количества показывается одна кнопка "В корзину", а при нажатии открывается модальное окно для выбора количества.

## Что изменилось

### До изменений
- Селектор количества (+ кнопки -) всегда был виден
- Кнопка "В корзину" показывала текущую сумму
- Занимало много места в карточке товара

### После изменений
- Одна кнопка "В корзину • цена₽"
- При нажатии открывается модальное окно с:
  - Заголовком "Выберите количество"
  - Кнопкой закрытия (X)
  - Селектором количества (- число +)
  - Итоговой суммой
  - Кнопкой "Добавить в корзину"

## Технические детали

### Файлы изменены
1. `src/app/tgapp/_components/AddToCartButton.tsx`
   - Добавлено состояние `showQuantitySelector`
   - Добавлена функция `handleShowQuantitySelector()`
   - Переработан рендер с условным отображением
   - Автоматическое закрытие модального окна после добавления

2. `src/app/tgapp/styles/catalog.css`
   - Добавлены стили для `.tgapp-quantity-modal`
   - Добавлена анимация `slideUp`
   - Стили для заголовка, кнопки закрытия, итоговой суммы
   - Адаптация под светлую и тёмную темы

### Новые CSS классы
- `.tgapp-quantity-modal` - контейнер модального окна
- `.tgapp-quantity-header` - заголовок с кнопкой закрытия
- `.tgapp-quantity-title` - текст заголовка
- `.tgapp-close-btn` - кнопка закрытия (X)
- `.tgapp-quantity-info` - контейнер для итоговой суммы
- `.tgapp-total-price` - текст итоговой суммы
- `.tgapp-confirm-button` - кнопка подтверждения

### Анимация
- Модальное окно появляется с анимацией `slideUp` (0.3s)
- Плавное появление снизу вверх с изменением прозрачности

### UX улучшения
1. **Экономия места**: карточка товара стала компактнее
2. **Фокус на действии**: пользователь сначала решает добавить товар, потом выбирает количество
3. **Визуальная обратная связь**: итоговая сумма показывается в реальном времени
4. **Простота закрытия**: кнопка X или сброс количества к 1

### Поведение
- При нажатии "В корзину" открывается модальное окно
- Количество по умолчанию: 1
- После добавления в корзину:
  - Модальное окно закрывается
  - Количество сбрасывается к 1
  - Срабатывает виброотклик
  - Обновляется MainButton

## Совместимость

- ✅ Светлая тема Telegram
- ✅ Тёмная тема Telegram  
- ✅ Мобильные устройства
- ✅ Планшеты
- ✅ Виброотклик
- ✅ Анимации

## Тестирование

Для тестирования:
1. Открыть https://strattera.ngrok.app/tgapp/catalog
2. Нажать кнопку "В корзину" на любом товаре
3. Проверить открытие модального окна
4. Изменить количество кнопками +/-
5. Проверить обновление итоговой суммы
6. Нажать "Добавить в корзину"
7. Проверить закрытие модального окна и обновление MainButton

Дата: 2025-01-29
Автор: AI Assistant 