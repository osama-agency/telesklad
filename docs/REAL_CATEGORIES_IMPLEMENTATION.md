# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–í Telegram WebApp –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –±—Ä–µ–Ω–¥—ã –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–∂–∏–¥–∞–ª —É–≤–∏–¥–µ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–∏–ø–∞ "–ü—Ä–æ—Ç–∏–≤–æ–∑–∞—á–∞—Ç–æ—á–Ω—ã–µ" –∏ –¥—Ä—É–≥–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ–±–ª–µ–º—ã:
- ‚ùå API –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–ª —Å–ø–∏—Å–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ (brand) –≤–º–µ—Å—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–ª–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º, –∞ –Ω–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ

–í —Ç–∞–±–ª–∏—Ü–µ `products` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π:
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ - —ç—Ç–æ –∑–∞–ø–∏—Å–∏ —Å `ancestry = '23'` (ID: 20, 21, 24, 36)
- –¢–æ–≤–∞—Ä—ã –∏–º–µ—é—Ç `ancestry` –≤–∏–¥–∞ `'23/ID_–∫–∞—Ç–µ–≥–æ—Ä–∏–∏'` (–Ω–∞–ø—Ä–∏–º–µ—Ä: "23/20", "23/24")
- –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —è–≤–ª—è—é—Ç—Å—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å ID 23

### –†–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –±–∞–∑–µ:
- **ID: 20** - "–°–î–í–ì" 
- **ID: 21** - "–î–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è"
- **ID: 24** - "–ü—Ä–æ—Ç–∏–≤–æ–∑–∞—á–∞—Ç–æ—á–Ω—ã–µ"
- **ID: 36** - "–î—Ä—É–≥–æ–µ"

### 1. –ù–æ–≤—ã–π API –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–§–∞–π–ª**: `src/app/api/webapp/categories/route.ts`

```typescript
// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∑–∞–ø–∏—Å–∏ —Å ancestry = 23)
const categories = await prisma.products.findMany({
  where: {
    ancestry: '23',
    deleted_at: null,
    show_in_webapp: true,
  },
  select: { id: true, name: true },
});

// –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const count = await prisma.products.count({
  where: {
    ancestry: {
      startsWith: `23/${category.id}`,
    },
  },
});
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API –ø—Ä–æ–¥—É–∫—Ç–æ–≤

**–§–∞–π–ª**: `src/app/api/webapp/products/route.ts`

```typescript
// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
where: {
  ...(category ? {
    ancestry: {
      startsWith: `23/${category}`, // –¢–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    },
  } : {
    ancestry: {
      contains: '/', // –í—Å–µ —Ç–æ–≤–∞—Ä—ã
    },
  }),
}
```

### 3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ —Ö—É–∫–µ

**–§–∞–π–ª**: `src/hooks/useProductsWithSubscriptions.ts`

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ API
if (category) params.append('category', category);

// –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
}, [search, category, user?.tg_id]);
```

## üì± –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è (–°–î–í–ì, –ü—Ä–æ—Ç–∏–≤–æ–∑–∞—á–∞—Ç–æ—á–Ω—ã–µ, –î–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è, –î—Ä—É–≥–æ–µ)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –∞ –Ω–µ –ø–æ –±—Ä–µ–Ω–¥–∞–º
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## üîç –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] API –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å ancestry = '23'
- [x] API –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ ancestry '23/categoryId'
- [x] –•—É–∫ –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ API
- [x] –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
- [x] –°—á–µ—Ç—á–∏–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
products (—Ç–∞–±–ª–∏—Ü–∞)
‚îú‚îÄ‚îÄ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (ancestry = '23')
‚îÇ   ‚îú‚îÄ‚îÄ ID: 20, name: "–°–î–í–ì"
‚îÇ   ‚îú‚îÄ‚îÄ ID: 21, name: "–î–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è"
‚îÇ   ‚îú‚îÄ‚îÄ ID: 24, name: "–ü—Ä–æ—Ç–∏–≤–æ–∑–∞—á–∞—Ç–æ—á–Ω—ã–µ"
‚îÇ   ‚îî‚îÄ‚îÄ ID: 36, name: "–î—Ä—É–≥–æ–µ"
‚îÇ
‚îî‚îÄ‚îÄ –¢–æ–≤–∞—Ä—ã (ancestry = '23/ID_–∫–∞—Ç–µ–≥–æ—Ä–∏–∏')
    ‚îú‚îÄ‚îÄ ancestry: "23/20" - —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –°–î–í–ì
    ‚îú‚îÄ‚îÄ ancestry: "23/21" - —Ç–æ–≤–∞—Ä—ã –¥–ª—è –ø–æ—Ö—É–¥–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ ancestry: "23/24" - –ø—Ä–æ—Ç–∏–≤–æ–∑–∞—á–∞—Ç–æ—á–Ω—ã–µ
    ‚îî‚îÄ‚îÄ ancestry: "23/36" - –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
```

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-27  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ 