# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ Telegram –±–æ—Ç–æ–≤

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ –±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏:

1. **@strattera_bot** (–æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
   - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Rails —Å–µ—Ä–≤–µ—Ä–µ
   - –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

2. **@strattera_test_bot** (—Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
   - ID: 7754514670
   - Webhook: `/api/telegram/webapp-webhook`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

3. **@telesklad_bot** (–±–æ—Ç –¥–ª—è –∞–¥–º–∏–Ω–æ–≤/–∑–∞–∫—É–ø–æ–∫)
   - ID: 7612206140
   - Webhook: `/api/telegram/telesklad-webhook`
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –∏ –∑–∞–∫—É–ø—â–∏–∫–æ–≤
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É –∑–∞–∫—É–ø–æ–∫

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–æ–≤**:
   - –ö–∞–∂–¥—ã–π –±–æ—Ç —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π endpoint
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ Bot ID –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—É—Ç–∞–Ω–∏—Ü—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π `TelegramBotWorker` —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏**:
   - –û–±–Ω–æ–≤–ª–µ–Ω `TelegramTokenService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –±–æ—Ç–∞–º–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

3. **–°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
   - –û–±–Ω–æ–≤–ª–µ–Ω `scripts/manage-webhooks.js`
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–æ–≤

```bash
# –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç (@strattera_test_bot)
node scripts/manage-webhooks.js setup test

# –ë–æ—Ç –¥–ª—è –∑–∞–∫—É–ø–æ–∫ (@telesklad_bot)
node scripts/manage-webhooks.js setup telesklad
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –Ω–∞ Rails (@strattera_bot)
RAILS_BOT_TOKEN=...

# –¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç (@strattera_test_bot)
WEBAPP_TELEGRAM_BOT_TOKEN=...

# –ë–æ—Ç –¥–ª—è –∑–∞–∫—É–ø–æ–∫ (@telesklad_bot)
TELESKLAD_BOT_TOKEN=...

# URL –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
NEXT_PUBLIC_APP_URL=https://strattera-admin.vercel.app
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ–±—Ö—É–∫–æ–≤
node scripts/manage-webhooks.js info test
node scripts/manage-webhooks.js info telesklad
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–ù–µ–≤–µ—Ä–Ω—ã–π Bot ID**:
   - –ó–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω —Å –∫–æ–¥–æ–º 403
   - –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω**:
   - –ë–æ—Ç –Ω–µ –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞

3. **–û—à–∏–±–∫–∞ Redis**:
   - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
   - –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —á–∏—Ç–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –ë–î

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ø—Ä–æ–µ–∫—Ç–µ NEXTADMIN –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ Telegram –±–æ—Ç–∞:
- **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç** `@telesklad_bot` (ID: 7612206140) - –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã –∞–¥–º–∏–Ω–æ–º
- **–¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç** `@strattera_test_bot` (ID: 7754514670) - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ WebApp

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–ª "–û–ø–ª–∞—Ç–∞ –ø—Ä–∏—à–ª–∞" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ, callback –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Ç–µ—Å—Ç–æ–≤—ã–º –±–æ—Ç–æ–º, —á—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫–∏:
- `ETELEGRAM: 400 Bad Request: query is too old and response timeout expired`
- –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–ª—É—á–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã

## –†–µ—à–µ–Ω–∏–µ

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ webhook endpoints

–°–æ–∑–¥–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ webhook endpoints –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞:
- **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç** `@telesklad_bot` ‚Üí `/api/telegram/telesklad-webhook`
- **–¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç** `@strattera_test_bot` ‚Üí `/api/telegram/webapp-webhook`

### 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ callback'–∞

–í `TelegramBotWorker.handleApprovePayment()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–æ—Ç–∞:

```typescript
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –æ—Ç –∫–∞–∫–æ–≥–æ –±–æ—Ç–∞ –ø—Ä–∏—à–µ–ª callback
const messageBotId = query.message.from?.id;
const isMainBot = messageBotId === 7612206140; // @telesklad_bot
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ answerCallbackQuery

```typescript
if (isMainBot) {
  // –û—Ç–≤–µ—á–∞–µ–º —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
  const MAIN_BOT_TOKEN = '7612206140:AAHA6sV7VZLyUu0Ua1DAoULiFYehAkAjJK4';
  const answerUrl = `https://api.telegram.org/bot${MAIN_BOT_TOKEN}/answerCallbackQuery`;
  
  await fetch(answerUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      callback_query_id: query.id,
      text: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –æ–ø–ª–∞—Ç—É...',
      show_alert: false
    })
  });
} else if (this.bot) {
  // –û—Ç–≤–µ—á–∞–µ–º —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
  await this.bot.answerCallbackQuery(query.id, { 
    text: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –æ–ø–ª–∞—Ç—É...',
    show_alert: false 
  });
}
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

```typescript
if (isMainBot) {
  // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
  const editResponse = await fetch(editUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: query.message.chat.id,
      message_id: query.message.message_id,
      text: finalMessage,
      parse_mode: 'HTML',
      reply_markup: { inline_keyboard: [] }
    })
  });
} else if (this.bot) {
  // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
  await this.bot.editMessageText(finalMessage, {
    chat_id: query.message.chat.id,
    message_id: query.message.message_id,
    parse_mode: 'HTML',
    reply_markup: { inline_keyboard: [] }
  });
}
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π "–Ø –æ–ø–ª–∞—Ç–∏–ª" (–∫–ª–∏–µ–Ω—Ç)
1. –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç "–Ø –æ–ø–ª–∞—Ç–∏–ª" –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –±–æ—Ç–µ
2. –ó–∞–∫–∞–∑ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å `0` (unpaid) –Ω–∞ `1` (paid)
3. `ReportService.onPaid()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
4. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π "–û–ø–ª–∞—Ç–∞ –ø—Ä–∏—à–ª–∞" (–∞–¥–º–∏–Ω)
1. –ê–¥–º–∏–Ω –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∞ –ø—Ä–∏—à–ª–∞" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ
2. `TelegramBotWorker.handleApprovePayment()` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
3. –ó–∞–∫–∞–∑ –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Å `1` (paid) –Ω–∞ `2` (processing)
4. –°–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
5. `ReportService.onProcessing()` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:

```
‚ù§Ô∏è –ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –≤–∞—Å –∑–∞ –ø–æ–∫—É–ø–∫—É!

üöö –ó–∞–∫–∞–∑ ‚Ññ24486 –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —É –∫—É—Ä—å–µ—Ä–∞ –∏ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ.

–ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –º—ã –Ω–µ–∑–∞–º–µ–¥–ª–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–ª–µ–º –≤–∞–º —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.

–ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 5 –¥–æ 48 —á–∞—Å–æ–≤.

–ë—É–¥–µ–º –ø—Ä–∏–∑–Ω–∞—Ç–µ–ª—å–Ω—ã –∑–∞ –≤–∞—à–µ —Ç–µ—Ä–ø–µ–Ω–∏–µ!
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –¢–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤
- **–û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç:** `7612206140:AAHA6sV7VZLyUu0Ua1DAoULiFYehAkAjJK4`
- **–¢–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç:** –ü–æ–ª—É—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `TelegramTokenService.getTelegramBotToken()`

### Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–û–±–∞ –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω webhook endpoint: `https://strattera.ngrok.app/api/telegram/webhook`

### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
- `0` - unpaid (–Ω–µ –æ–ø–ª–∞—á–µ–Ω)
- `1` - paid (–æ–ø–ª–∞—á–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)
- `2` - processing (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω, —É –∫—É—Ä—å–µ—Ä–∞)
- `3` - shipped (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–º)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ Callback'–∏ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –±–æ—Ç
‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚úÖ –û—à–∏–±–∫–∏ "query is too old" —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–æ–π

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ WebApp
2. –ù–∞–∂–∞—Ç—å "–Ø –æ–ø–ª–∞—Ç–∏–ª" –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –±–æ—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ
4. –ù–∞–∂–∞—Ç—å "–û–ø–ª–∞—Ç–∞ –ø—Ä–∏—à–ª–∞" –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏

–î–∞—Ç–∞: 24 —è–Ω–≤–∞—Ä—è 2025
–°—Ç–∞—Ç—É—Å: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É Telegram –±–æ—Ç–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–ö—É—Ä—å–µ—Ä –ø–æ–ª—É—á–∞–ª –∑–∞–¥–∞–Ω–∏–µ –≤ @telesklad_bot, –Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü—Ä–∏–≤—è–∑–∞—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä" –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –≤ @strattera_test_bot. –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—É –∏ –Ω–∞—Ä—É—à–∞–ª–æ –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã.

## –ü—Ä–∏—á–∏–Ω–∞
TelegramBotWorker - —ç—Ç–æ singleton, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ –±–æ—Ç–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö webhook'–∞—Ö:
- `/api/telegram/telesklad-webhook` ‚Üí @telesklad_bot
- `/api/telegram/webapp-webhook` ‚Üí @strattera_test_bot

–ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback'–æ–≤ –º–µ—Ç–æ–¥—ã `handleSubmitTracking` –∏ `handleTrackBack` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `this.bot`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥ –±—ã—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –±–æ—Ç–æ–º.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ callback'–∞
–í –º–µ—Ç–æ–¥–∞—Ö `handleSubmitTracking`, `handleTrackBack` –∏ `handleApprovePayment` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–æ—Ç–∞ –ø–æ `message.from.id`:

```typescript
const messageBotId = query.message.from?.id;
const isMainBot = messageBotId === 7612206140; // @telesklad_bot
```

### 2. –£—Å–ª–æ–≤–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
```typescript
if (isMainBot) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º—ã–µ API –≤—ã–∑–æ–≤—ã –∫ @telesklad_bot
  const MAIN_BOT_TOKEN = '7612206140:AAHA6sV7VZLyUu0Ua1DAoULiFYehAkAjJK4';
  await fetch(`https://api.telegram.org/bot${MAIN_BOT_TOKEN}/sendMessage`, ...);
} else {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º this.bot –¥–ª—è @strattera_test_bot
  await this.bot.sendMessage(...);
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- `handleSubmitTracking()` - –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞
- `handleTrackBack()` - –≤–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ—Ç–∞–ª—è–º –∑–∞–∫–∞–∑–∞  
- `handleApprovePayment()` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã (—É–∂–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ü—Ä–∏–≤—è–∑–∞—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä" –≤ @telesklad_bot:
1. ‚úÖ –ó–∞–ø—Ä–æ—Å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ @telesklad_bot
2. ‚úÖ –ö—É—Ä—å–µ—Ä –≤–≤–æ–¥–∏—Ç —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –≤ —Ç–æ–º –∂–µ –±–æ—Ç–µ
3. ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–º
4. ‚úÖ –í—Å—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –±–æ—Ç–∞—Ö

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–æ–≤

### @telesklad_bot (7612206140)
- –ê–¥–º–∏–Ω—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä—É
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã

### @strattera_test_bot (7754514670)  
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ development
- WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∫—É—Ä—å–µ—Ä—É
curl -X POST "https://api.telegram.org/bot7612206140:AAHA6sV7VZLyUu0Ua1DAoULiFYehAkAjJK4/sendMessage" \
  -H "Content-Type: application/json" \
  -d '{
    "chat_id": "7690550402",
    "text": "üëÄ –ù—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ ‚Ññ12345",
    "reply_markup": {
      "inline_keyboard": [[{
        "text": "–ü—Ä–∏–≤—è–∑–∞—Ç—å —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä", 
        "callback_data": "submit_tracking"
      }]]
    }
  }'
```

## –õ–æ–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
ü§ñ Submit tracking callback from bot ID: 7612206140, isMainBot: true
‚úÖ Tracking request sent via main bot
```

–ê –ù–ï:
```
ü§ñ Submit tracking callback from bot ID: 7612206140, isMainBot: true
‚úÖ Tracking request sent via test bot
``` 