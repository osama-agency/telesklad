# üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ S3

## üîç –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (`scripts/migrate-images-to-s3.js`)
- –û–±–Ω–æ–≤–ª–µ–Ω S3Service —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Beget S3
- API webapp –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ —Å –Ω–æ–≤—ã–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

‚ùå **–¢—Ä–µ–±—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ Secret Key –æ—Ç Beget
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

## üîß –®–∞–≥–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### 1. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—ã–π Secret Key

1. –í–æ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Beget
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª Cloud Storage
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à –±–∞–∫–µ—Ç `2c11548b454d-eldar-agency`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π Secret Key (–Ω–µ –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π)

### 2. –û–±–Ω–æ–≤–∏—Ç–µ .env.local

–ó–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ `.env.local`:
```env
S3_SECRET_KEY=–ü–û–õ–ù–´–ô_SECRET_KEY_–û–¢_BEGET
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
node scripts/test-single-image.js

# –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
node scripts/migrate-images-to-s3.js migrate
```

### 4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ S3Service –Ω–∞ –Ω–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–∏—Ç–µ `src/lib/services/s3.ts`:

```typescript
export class S3Service {
  static getImageUrl(key: string): string {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤–æ–µ Beget S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    const endpoint = process.env.S3_ENDPOINT || 'https://s3.ru1.storage.beget.cloud';
    const bucket = process.env.S3_BUCKET || '2c11548b454d-eldar-agency';
    return `${endpoint}/${bucket}/products/${key}`;
  }
  
  static getOldImageUrl(key: string): string {
    // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç URL (–¥–ª—è fallback)
    const prefix1 = key.substring(0, 2);
    const prefix2 = key.substring(2, 4);
    return `https://strattera.tgapp.online/storage/${prefix1}/${prefix2}/${key}`;
  }
}
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:** 32
- **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** ~2.4 MB (—Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä 76KB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
- **–í—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏:** ~3-5 –º–∏–Ω—É—Ç

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

- ‚úÖ –ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ webapp
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å CDN
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±–ª–∞–∫–µ

## üîÑ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç:** ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
**–ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞:** ‚è≥ (–æ–∂–∏–¥–∞–µ—Ç Secret Key)
**S3 –Ω–∞—Å—Ç—Ä–æ–µ–Ω:** ‚úÖ (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞) 