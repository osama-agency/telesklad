# Реализация страницы настроек пользователя

## Обзор

Полная реализация страницы настроек пользователя с поддержкой PostgreSQL и Prisma.

## Функциональность

### 1. Защита маршрута
- Страница `/pages/settings` защищена через NextAuth
- Неавторизованные пользователи перенаправляются на `/login`
- API endpoints защищены middleware

### 2. Загрузка данных
- Данные пользователя загружаются при загрузке страницы через API `/api/user/get-user`
- Поддержка состояний загрузки и ошибок
- Automatic retry функциональность

### 3. Обновление данных
- Поля: Полное имя, Email, Телефон, Фото профиля
- Валидация на клиенте и сервере
- Обновление NextAuth сессии после изменений
- Предотвращение обновления demo пользователей

### 4. Загрузка фото
- Поддержка файлов PNG, JPG, JPEG
- Preview изображения перед сохранением
- Интеграция с системой загрузки файлов
- Функция удаления/сброса фото

## Технические детали

### База данных
```sql
-- Добавлено поле в таблицу User
ALTER TABLE "User" ADD COLUMN "phone" TEXT;
```

### API Endpoints

#### GET /api/user/get-user
Получение данных текущего пользователя
```json
{
  "id": "string",
  "name": "string",
  "email": "string", 
  "phone": "string",
  "image": "string",
  "role": "string"
}
```

#### POST /api/user/update
Обновление данных пользователя
```json
{
  "name": "string",
  "email": "string",
  "phone": "string", 
  "image": "string"
}
```

### Компоненты

#### SettingBoxes
- Основной компонент страницы настроек
- Управление состоянием через React hooks
- Интеграция с NextAuth для обновления сессии
- Toast уведомления для пользователя

### Типы TypeScript
Расширены типы NextAuth для поддержки phone поля:
```typescript
interface User {
  phone?: string | null
}
```

## Безопасность

- Проверка авторизации на всех уровнях
- Защита от обновления demo пользователей  
- Валидация входных данных
- Защищенные API endpoints через middleware

## UX/UI особенности

- Индикаторы загрузки
- Обработка ошибок с понятными сообщениями
- Preview изображений
- Responsive дизайн
- Сохранение данных без перезагрузки страницы

## Поля пользователя

Доступные поля для редактирования:
- **Полное имя** - текстовое поле для имени пользователя
- **Email адрес** - поле email с валидацией
- **Номер телефона** - текстовое поле для телефона
- **Фото профиля** - загрузка и preview изображения 