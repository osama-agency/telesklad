# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ngrok –¥–ª—è –µ–¥–∏–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `.env.unified` - –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–∞–π–ª
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π .env –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ngrok, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω.

### 2. `.env.production-ready` - –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.

### 3. `.env.complete` - –®–∞–±–ª–æ–Ω
–ü–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω —Å–æ –≤—Å–µ–º–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã fallback URL
- `notification-executor.service.ts`: –∏–∑–º–µ–Ω–µ–Ω—ã fallback URL —Å `telesklad.ru` –Ω–∞ `strattera.ngrok.app`
- `telegram/webapp-bot/info/route.ts`: –æ–±–Ω–æ–≤–ª–µ–Ω localhost –Ω–∞ ngrok –¥–æ–º–µ–Ω

### 2. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è URL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- `NEXTAUTH_URL` = `https://strattera.ngrok.app`
- `WEBAPP_URL` = `https://strattera.ngrok.app/webapp`
- –ï–¥–∏–Ω—ã–µ URL –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ó–∞–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—É—â–∏–π .env
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp .env .env.backup-$(date +%Y%m%d)

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
cp .env.unified .env
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Next.js
pkill -f "next dev"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Next.js –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞ –ø–æ—Ä—Ç—É 3000
PORT=3000 npm run dev

# 3. –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ngrok
ngrok http --domain=strattera.ngrok.app 3000

# 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –±–æ—Ç–∞
npm run telegram:webhook:setup
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
- WebApp: https://strattera.ngrok.app/webapp
- API: https://strattera.ngrok.app/api/webapp/profile
- Webhook: https://strattera.ngrok.app/api/telegram/webhook

## üìä –ê–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- `DATABASE_URL` - PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- `NEXTAUTH_URL` - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `NEXTAUTH_SECRET` - –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- `WEBAPP_URL` - URL –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üîß –°–µ—Ä–≤–∏—Å—ã
- `S3_*` - —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤ (Beget)
- `OPENAI_API_KEY` - AI —Ñ—É–Ω–∫—Ü–∏–∏
- `DADATA_*` - —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–¥—Ä–µ—Å–∞
- `ADMIN_EMAILS` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã

### ü§ñ Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç `@strattera_test_bot`
- Webhook URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –Ω–∞ ngrok
- –í—Å–µ ID —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –ü–æ—Ä—Ç 3000 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω
Ngrok –¥–æ–º–µ–Ω `strattera.ngrok.app` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–º–µ–Ω–Ω–æ –Ω–∞ –ø–æ—Ä—Ç 3000. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø–æ—Ä—Ç–æ–≤ —Å–ª–æ–º–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

### 2. NODE_ENV=development
–û—Å—Ç–∞–≤–ª–µ–Ω development —Ä–µ–∂–∏–º –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞.

### 3. –û–±—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±—â–∞—è –¥–ª—è dev –∏ prod - –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏!

### 4. Webhook vs Polling
–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ webhook —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ ngrok, polling –æ—Ç–∫–ª—é—á–µ–Ω.

## üîç –ú–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. `src/lib/services/notification-executor.service.ts`
   - –ò–∑–º–µ–Ω–µ–Ω—ã fallback URL –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
   - –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `strattera.ngrok.app` –≤–º–µ—Å—Ç–æ `telesklad.ru`

2. `src/app/api/telegram/webapp-bot/info/route.ts`
   - –û–±–Ω–æ–≤–ª–µ–Ω fallback URL —Å localhost –Ω–∞ ngrok

### –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤:
- `src/lib/services/telegram-token.service.ts` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –≤ development —Ä–µ–∂–∏–º–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è fallback –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–æ—Ç–∞–º–∏
npm run telegram:switch:test    # —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
npm run telegram:switch:prod    # –ø—Ä–æ–¥–∞–∫—à–µ–Ω –±–æ—Ç

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ webhook
npm run telegram:webhook:setup  # –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
npm run telegram:webhook:info   # –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
npm run telegram:webhook:delete # —É–¥–∞–ª–∏—Ç—å

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
cat .env | grep -E "^[A-Z]" | cut -d= -f1 | sort
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è:
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å ngrok –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ URL –≤–æ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É dev –∏ prod —Ä–µ–∂–∏–º–∞–º–∏