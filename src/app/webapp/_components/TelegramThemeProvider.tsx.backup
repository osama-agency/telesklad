'use client';
import { useEffect, useState } from 'react';
import { telegramSDK } from '@/lib/telegram-sdk';

interface TelegramThemeProviderProps {
  children: React.ReactNode;
}

export default function TelegramThemeProvider({ children }: TelegramThemeProviderProps) {
  const [themeApplied, setThemeApplied] = useState(false);

  useEffect(() => {
    // ÐŸÐ Ð˜ÐÐ£Ð”Ð˜Ð¢Ð•Ð›Ð¬ÐÐž Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÐ²ÐµÑ‚Ð»ÑƒÑŽ Ñ‚ÐµÐ¼Ñƒ, Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÑ Telegram themeParams
    const forceLightTheme = () => {
      // Ð¡Ð²ÐµÑ‚Ð»Ð°Ñ Ñ‚ÐµÐ¼Ð° Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
      const lightTheme = {
        colorScheme: 'light' as const,
        backgroundColor: '#ffffff',
        textColor: '#000000',
        hintColor: '#999999',
        linkColor: '#48C928',
        buttonColor: '#48C928',
        buttonTextColor: '#ffffff'
      };
      
      // ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐ²ÐµÑ‚Ð»Ñ‹Ðµ CSS Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
      document.documentElement.style.setProperty('--tg-bg-color', lightTheme.backgroundColor);
      document.documentElement.style.setProperty('--tg-text-color', lightTheme.textColor);
      document.documentElement.style.setProperty('--tg-hint-color', lightTheme.hintColor);
      document.documentElement.style.setProperty('--tg-link-color', lightTheme.linkColor);
      document.documentElement.style.setProperty('--tg-button-color', lightTheme.buttonColor);
      document.documentElement.style.setProperty('--tg-button-text-color', lightTheme.buttonTextColor);
      
      // Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð»ÑŽÐ±Ñ‹Ðµ Ñ‚ÐµÐ¼Ð½Ñ‹Ðµ ÐºÐ»Ð°ÑÑÑ‹ Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ²ÐµÑ‚Ð»Ñ‹Ð¹
      document.body.classList.remove('tg-theme-dark');
      document.body.classList.add('tg-theme-light');
      
      // Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐ¼Ð½Ñ‹Ðµ ÑÑ‚Ð¸Ð»Ð¸ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°
      document.documentElement.style.setProperty('color-scheme', 'light');
      document.body.style.colorScheme = 'light';
      
             // ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ dark mode
       if (telegramSDK.isAvailable()) {
         try {
           // ÐŸÐµÑ€ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÐ¼ Telegram Ñ‚ÐµÐ¼Ñ‹ ÐµÑÐ»Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾
           const tg = window.Telegram?.WebApp;
           if (tg && (tg as any).themeParams) {
             const themeParams = (tg as any).themeParams;
             themeParams.bg_color = '#ffffff';
             themeParams.text_color = '#000000';
             themeParams.hint_color = '#999999';
             themeParams.link_color = '#48C928';
             themeParams.button_color = '#48C928';
             themeParams.button_text_color = '#ffffff';
           }
         } catch (error) {
           console.warn('Could not override Telegram theme params:', error);
         }
       }
      
      console.log('ðŸŒž Forced light theme applied, ignoring Telegram themeParams');
    };

    forceLightTheme();
    setThemeApplied(true);

    // ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð¿Ñ€Ð¸ Ñ€Ð°Ð·Ð¼Ð¾Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
    return () => {
      document.body.classList.remove('tg-theme-light', 'tg-theme-dark');
    };
  }, []);

  return (
    <div className={`webapp-container ${themeApplied ? 'tg-themed' : ''}`}>
      {children}
    </div>
  );
} 