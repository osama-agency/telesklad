// ========================================
// CATALOG MODULE - .catalog- namespace
// ========================================

// Catalog page container
.catalog-page {
  // Base layout
  .catalog-container {
    @include stack(var(--space-4));
    width: 100%;
    max-width: 100%;
    min-height: 100vh;
    
    // Safe area support
    @include safe-area-padding;
    padding-top: max(env(safe-area-inset-top), 0);
    padding-bottom: calc(60px + env(safe-area-inset-bottom)); // For floating cart
  }
  
  // Header integration
  .catalog-header {
    margin-bottom: 0;
    
    .catalog-header-search {
      padding: var(--space-2) var(--space-3);
      
      .catalog-search-field {
        @include flex-center;
        min-height: 36px;
        padding: var(--space-1) var(--space-2);
        border-radius: 8px;
        border: 1px solid var(--color-border);
        background: var(--color-bg);
        color: var(--color-text);
        
        &:focus {
          border-color: var(--color-primary);
          outline: none;
        }
        
        &::placeholder {
          color: var(--color-text-light);
        }
      }
    }
  }
  
  // Category navigation
  .catalog-category-nav {
    margin-top: var(--space-2);
    margin-bottom: var(--space-3);
    padding: 0;
    
    .catalog-nav-list {
      @include inline-stack(var(--space-1));
      @include hide-scrollbar;
      overflow-x: auto;
      padding: 0 var(--space-4);
      
      .catalog-nav-item {
        flex-shrink: 0;
        
        .catalog-nav-button {
          @include button-base;
          @include no-focus;
          
          min-height: 34px;
          padding: var(--space-1) var(--space-3);
          font-size: var(--font-size-xs);
          font-weight: var(--font-weight-medium);
          border-radius: 17px;
          background: var(--color-bg);
          border: 1px solid var(--color-border);
          color: var(--color-text);
          transition: all var(--tg-transition-fast);
          
          &:hover {
            background: var(--color-bg-light);
          }
          
          &.catalog-nav-active {
            background: var(--color-primary);
            color: var(--color-bg-white);
            border-color: var(--color-primary);
          }
        }
      }
    }
  }
  
  // Product catalog container
  .catalog-product-container {
    min-height: 200px;
    position: relative;
    width: 100%;
    overflow: visible;
    padding: 0 var(--space-1); // For card shadows
    
    .catalog-product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-2);
      margin-top: 0;
      padding-top: 0;
      
      @include mobile {
        gap: var(--space-2);
      }
      
      @include tablet {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-3);
      }
      
      @include desktop {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-4);
      }
    }
  }
  
  // Loading states
  .catalog-loading {
    .catalog-grid-skeleton {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-2);
      padding: 0;
      
      .catalog-product-skeleton {
        @include card;
        padding: var(--space-2);
        
        .catalog-skeleton-image {
          width: 100%;
          height: 140px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          border-radius: 8px;
          margin-bottom: var(--space-2);
        }
        
        .catalog-skeleton-title {
          height: 14px;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          border-radius: 4px;
          margin-bottom: var(--space-1);
        }
        
        .catalog-skeleton-price {
          height: 12px;
          width: 60%;
          background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
          background-size: 200% 100%;
          animation: shimmer 1.5s infinite;
          border-radius: 4px;
        }
      }
    }
    
    .catalog-category-skeleton {
      @include inline-stack(var(--space-2));
      @include hide-scrollbar;
      overflow-x: auto;
      padding: var(--space-2) var(--space-4);
      
      .catalog-skeleton-category {
        flex-shrink: 0;
        height: 32px;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 16px;
        
        &:nth-child(1) { width: 80px; }
        &:nth-child(2) { width: 100px; }
        &:nth-child(3) { width: 120px; }
        &:nth-child(4) { width: 90px; }
      }
    }
  }
  
  // Empty states
  .catalog-empty {
    @include flex-column-center;
    text-align: center;
    min-height: 40vh;
    padding: var(--space-5);
    
    .catalog-empty-icon {
      font-size: 48px;
      color: var(--color-text-lighter);
      margin-bottom: var(--space-3);
      opacity: 0.8;
    }
    
    .catalog-empty-title {
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-light);
      margin-bottom: var(--space-1);
    }
    
    .catalog-empty-subtitle {
      font-size: var(--font-size-sm);
      color: var(--color-text-lighter);
      line-height: 1.4;
    }
  }
  
  // Error states
  .catalog-error {
    @include flex-column-center;
    text-align: center;
    padding: var(--space-8) var(--space-5);
    
    .catalog-error-icon {
      font-size: 40px;
      color: var(--color-error);
      margin-bottom: var(--space-3);
      opacity: 0.8;
    }
    
    .catalog-error-message {
      font-size: var(--font-size-sm);
      color: var(--color-text-light);
      margin-bottom: var(--space-4);
    }
    
    .catalog-retry-button {
      @include button-primary;
      padding: var(--space-2) var(--space-6);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-semibold);
    }
  }
  
  // Pull to refresh
  .catalog-pull-refresh {
    position: absolute;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 40px;
    background: var(--color-primary);
    border-radius: 50%;
    @include flex-center;
    transition: all var(--tg-transition-normal);
    opacity: 0;
    z-index: var(--z-overlay);
    
    &.catalog-pulling {
      opacity: 1;
      top: 10px;
    }
    
    .catalog-refresh-spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--color-bg-white);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
  }
}

// Animations
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.catalog-item-appear {
  animation: catalogItemAppear 0.3s ease-out;
  animation-fill-mode: both;
  
  // Staggered animation
  @for $i from 1 through 20 {
    &:nth-child(#{$i}) {
      animation-delay: #{$i * 0.02}s;
    }
  }
}

@keyframes catalogItemAppear {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

// Responsive optimizations
@include mobile {
  .catalog-page {
    .catalog-category-nav {
      margin-top: var(--space-1);
      margin-bottom: var(--space-2);
      
      .catalog-nav-list {
        .catalog-nav-item {
          .catalog-nav-button {
            min-height: 30px;
            padding: var(--space-1) var(--space-2);
            font-size: var(--font-size-xs);
          }
        }
      }
    }
    
    .catalog-product-container {
      .catalog-product-grid {
        gap: var(--space-1);
      }
    }
    
    .catalog-empty {
      min-height: 30vh;
      padding: var(--space-4);
    }
  }
}

// Small screen optimizations
@media (max-height: 600px) {
  .catalog-page {
    .catalog-category-nav {
      margin-top: var(--space-1);
      margin-bottom: var(--space-2);
    }
    
    .catalog-empty {
      min-height: 30vh;
      padding: var(--space-4);
    }
  }
}

// Debug mode (development only)
.catalog-debug {
  .catalog-product-container {
    border: 2px dashed red !important;
    background: rgba(255, 0, 0, 0.05) !important;
  }
  
  .catalog-product-grid {
    border: 2px dashed blue !important;
    background: rgba(0, 0, 255, 0.05) !important;
  }
  
  .catalog-empty {
    border: 2px dashed green !important;
    background: rgba(0, 255, 0, 0.05) !important;
  }
}

// Integration with legacy styles (temporary)
.webapp-container.catalog-page.catalog-enabled {
  @extend .catalog-page;
} 