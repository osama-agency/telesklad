/* Telegram Design System Styles */
/* Совместимость с существующими стилями сохранена */

/* CSS Custom Properties для Telegram темы */
:root {
  /* Telegram цвета с fallback на светлую тему */
  --tg-bg-color: var(--telegram-bg-color, #ffffff);
  --tg-text-color: var(--telegram-text-color, #000000);
  --tg-hint-color: var(--telegram-hint-color, #999999);
  --tg-link-color: var(--telegram-link-color, #48C928);
  --tg-button-color: var(--telegram-button-color, #48C928);
  --tg-button-text-color: var(--telegram-button-text-color, #ffffff);
  --tg-secondary-bg-color: var(--telegram-secondary-bg-color, #f0fcf0);
  
  /* Telegram Design System переменные */
  --tg-header-height: 60px;
  --tg-safe-area-top: 0px;
  --tg-safe-area-bottom: 0px;
  --tg-safe-area-left: 0px;
  --tg-safe-area-right: 0px;
  
  /* Анимации для 60fps */
  --tg-transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
  --tg-transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
  --tg-transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Telegram Design Header - расширяет существующий webapp-header */
.telegram-design-header {
  /* Наследуем все стили от .webapp-header */
  position: sticky;
  top: 0;
  z-index: 1000;
  background-color: var(--tg-bg-color);
  color: var(--tg-text-color);
  
  /* Новые Telegram Guidelines стили */
  transition: all var(--tg-transition-normal);
  will-change: transform, box-shadow;
  
  /* Safe area support */
  padding-top: var(--tg-safe-area-top);
  padding-left: var(--tg-safe-area-left);
  padding-right: var(--tg-safe-area-right);
  
  /* Улучшенная тень при скролле */
  &.scrolled {
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  
  /* Оптимизация для слабых устройств */
  &.low-end {
    will-change: auto; /* Отключаем will-change для экономии памяти */
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    
    &.scrolled {
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.12); /* Упрощенная тень */
    }
  }
  
  /* Кнопки действий с Telegram Design Guidelines */
  .header-action-button {
    /* Сохраняем существующие стили + улучшения */
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px;
    border-radius: 12px;
    transition: none !important; /* УБИРАЕМ ВСЕ АНИМАЦИИ */
    cursor: pointer;
    
    /* Telegram стили */
    color: var(--tg-text-color);
    background-color: transparent;
    
    /* БЕЗ АНИМАЦИЙ при hover и active */
    &:hover {
      background-color: transparent !important;
      transform: none !important;
      color: var(--tg-text-color) !important; /* Цвет НЕ меняется */
    }
    
    &.active {
      color: var(--tg-link-color) !important; /* Только цвет для активной страницы */
      background-color: transparent !important;
      
      &:hover,
      &:active {
        color: var(--tg-link-color) !important; /* Сохраняем цвет активной страницы */
        background-color: transparent !important;
      }
    }
    
    /* Accessibility улучшения - оставляем для доступности */
    &:focus-visible {
      outline: 2px solid var(--tg-link-color);
      outline-offset: 2px;
    }
    
    /* БЕЗ анимации при клике */
    &:active {
      transform: none !important;
      background-color: transparent !important;
    }
    
    /* Badge стили */
    .header-action-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
      color: var(--tg-button-text-color);
      background-color: var(--tg-button-color);
      border-radius: 9px;
      padding: 0 4px;
      line-height: 1;
      
      /* Анимация появления */
      animation: tgBadgeAppear var(--tg-transition-normal) ease-out;
    }
  }
  
  /* Profile avatar стили */
  .header-profile-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    object-fit: cover; /* Важно для правильного отображения круглого аватара */
    border: 2px solid var(--tg-secondary-bg-color);
    transition: none !important; /* БЕЗ анимаций */
    
    .header-action-button.active & {
      border-color: var(--tg-link-color);
    }
  }
}

/* Анимации */
@keyframes tgBadgeAppear {
  0% {
    opacity: 0;
    transform: scale(0.5);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* Responsive breakpoints по Telegram Guidelines */
@media (max-width: 480px) {
  .telegram-design-header {
    .header-action-button {
      padding: 6px; /* Меньше padding на мобильных */
    }
  }
}

/* Dark theme support (опционально, сейчас отключено в проекте) */
@media (prefers-color-scheme: dark) {
  .telegram-design-header.support-dark-theme {
    --tg-bg-color: #1c1c1e;
    --tg-text-color: #ffffff;
    --tg-hint-color: #8e8e93;
    --tg-secondary-bg-color: #2c2c2e;
  }
}

/* Интеграция с существующими стилями webapp-header */
.webapp-header.telegram-design-header {
  /* Переопределяем только необходимые стили, остальное наследуем */
  
  .webapp-header-container {
    /* Сохраняем существующую структуру */
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    max-width: 100%;
    margin: 0 auto;
  }
  
  .webapp-header-search {
    /* Наследуем от существующих стилей */
    flex: 1;
    margin-right: 16px;
  }
  
  .webapp-header-actions {
    /* Наследуем от существующих стилей */
    display: flex;
    align-items: center;
    gap: 8px;
  }
}

/* Обратная совместимость - гарантируем, что старые стили работают */
.webapp-header:not(.telegram-design-header) {
  /* Все старые стили сохраняются без изменений */
  /* Этот селектор гарантирует, что при отключенном enableDesignSystem */
  /* все работает как раньше */
} 