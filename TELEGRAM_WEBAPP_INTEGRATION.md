# Telegram WebApp Integration

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp SDK –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã. –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:

1. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –≤ Telegram –±–æ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–∫–∞–∑–∞
2. **–ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebApp** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 
3. **–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –æ –∑–∞–∫–∞–∑–µ –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SDK –≤ layout

–í `src/app/webapp/layout.tsx`:
- –î–æ–±–∞–≤–ª–µ–Ω `Script` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Telegram WebApp SDK
- SDK –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π `beforeInteractive`

### 2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤ –∫–æ—Ä–∑–∏–Ω–µ

–í `src/app/webapp/cart/page.tsx`:
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è Telegram WebApp API
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ WebApp –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞:

1. **–°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–∫–∞–∑** —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API `/api/webapp/orders`
2. **–û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç** —á–µ—Ä–µ–∑ `window.Telegram.WebApp.sendData()`:
   ```json
   {
     "action": "order_placed",
     "order_id": 12345,
     "total": 2500,
     "items_count": 3,
     "delivery_address": "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 10",
     "customer_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
     "customer_phone": "+7900123456"
   }
   ```
3. **–ó–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è WebApp** —á–µ—Ä–µ–∑ `window.Telegram.WebApp.close()`

### Fallback –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞:
- –ï—Å–ª–∏ WebApp SDK –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π alert
- –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–∫–∞–∑–æ–≤

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç WebApp –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `web_app_data`:

```python
@bot.message_handler(content_types=['web_app_data'])
def handle_web_app_data(message):
    data = json.loads(message.web_app_data.data)
    
    if data['action'] == 'order_placed':
        # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É
        bot.send_message(
            message.chat.id,
            f"‚úÖ –ó–∞–∫–∞–∑ #{data['order_id']} –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n"
            f"üí∞ –°—É–º–º–∞: {data['total']} ‚ÇΩ\n"
            f"üì¶ –¢–æ–≤–∞—Ä–æ–≤: {data['items_count']}\n"
            f"üìç –ê–¥—Ä–µ—Å: {data['delivery_address']}\n"
            f"üìû –¢–µ–ª–µ—Ñ–æ–Ω: {data['customer_phone']}"
        )
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í Telegram:
1. –û—Ç–∫—Ä—ã—Ç—å WebApp —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É  
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
4. –ù–∞–∂–∞—Ç—å "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
5. WebApp –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –ø—Ä–∏–¥–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —á–∞—Ç

### –í –±—Ä–∞—É–∑–µ—Ä–µ:
1. –û—Ç–∫—Ä—ã—Ç—å `/webapp/cart`
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
3. –ü—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ - –æ–±—ã—á–Ω—ã–π alert –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `src/app/webapp/layout.tsx` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SDK
- `src/app/webapp/cart/page.tsx` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- `TELEGRAM_WEBAPP_INTEGRATION.md` - —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram WebApp
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (fallback)
- ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π –¥–∏–∑–∞–π–Ω 