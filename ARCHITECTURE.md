# ğŸ—ï¸ Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° NextAdmin

## ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€

NextAdmin - ÑÑ‚Ğ¾ ÑĞ»Ğ¾Ğ¶Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ e-commerce Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¾Ğ¼, Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ğ°Ñ Ğ½Ğ° Next.js 15 Ñ Ğ´Ğ²ÑƒĞ¼Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼Ğ¸:
- **ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ** - Ğ²ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ¾Ğ¼
- **Telegram WebApp** - Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²

## ğŸ›ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹

### Clean Architecture - ÑĞ»Ğ¾ĞµĞ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Presentation Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ React       â”‚ Pages/Layouts        â”‚  â”‚
â”‚  â”‚ Components  â”‚ API Routes           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Application Layer             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Services    â”‚ Context Providers    â”‚  â”‚
â”‚  â”‚ Layer       â”‚ Custom Hooks         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             Domain Layer                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Business    â”‚ Types/Interfaces     â”‚  â”‚
â”‚  â”‚ Logic       â”‚ Utilities            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Infrastructure Layer          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Prisma ORM  â”‚ External APIs        â”‚  â”‚
â”‚  â”‚ Database    â”‚ File Storage         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹

### 1. Service Layer Pattern

Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸, Ğ²ÑĞµ Ñ€Ğ°ÑĞ¿Ğ¾Ğ»Ğ¾Ğ¶ĞµĞ½Ñ‹ Ğ² `src/lib/services/`:

#### TelegramBotService (`telegram-bot.service.ts`)
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² Telegram
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ Ğ¾ Ğ·Ğ°ĞºÑƒĞ¿ĞºĞ°Ñ…
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº

```typescript
export class TelegramBotService {
  private static BOT_TOKEN: string | null = null;
  private static API_URL: string | null = null;
  
  static async sendPurchaseToSupplier(purchase: Purchase): Promise<{success: boolean; messageId?: number}> {
    // Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ·Ğ°ĞºÑƒĞ¿Ğ¾Ğº
  }
  
  static async sendPaymentNotification(purchaseId: number, purchaseData: any): Promise<{success: boolean; messageId?: number}> {
    // Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ°Ğ¼Ğ¸
  }
}
```

#### ExchangeRateService (`exchange-rate.service.ts`)
- ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ĞºÑƒÑ€ÑĞ¾Ğ² Ğ²Ğ°Ğ»ÑÑ‚ Ğ¾Ñ‚ Ğ¦Ğ‘ Ğ Ğ¤
- ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ²Ğ°Ğ»ÑÑ‚ Ñ Ğ±ÑƒÑ„ĞµÑ€Ğ°Ğ¼Ğ¸
- Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞ¹ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹ Ğ´Ğ»Ñ Ğ·Ğ°ĞºÑƒĞ¿Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ñ†ĞµĞ½

```typescript
export class ExchangeRateService {
  static async updateTRYRate(): Promise<{success: boolean; rate?: number}> {
    const cbrData = await this.fetchCBRRates();
    const tryRate = tryData.Value / tryData.Nominal; // Ğ£Ñ‡ĞµÑ‚ Ğ½Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ»Ğ°
    await this.updateExchangeRate('TRY', tryRate);
  }
  
  static calculateMovingAverage(currentStock: number, currentAvgPrice: number, newQuantity: number, newPricePerUnit: number): number {
    // ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° ÑĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞ¹ ÑÑ€ĞµĞ´Ğ½ĞµĞ¹
  }
}
```

#### TelegramTokenService (`telegram-token.service.ts`)
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸ Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼
- ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ fallback Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸
- Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Telegram API

```typescript
export class TelegramTokenService {
  private static tokenCache: {
    telegram_bot_token?: string;
    webapp_telegram_bot_token?: string;
    lastUpdated: number;
  } = { lastUpdated: 0 };

  static async getTelegramBotToken(): Promise<string | null> {
    // 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºÑÑˆĞ° (Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
    if (this.isCacheValid() && this.tokenCache.telegram_bot_token) {
      return this.tokenCache.telegram_bot_token;
    }

    // 2. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº)
    const setting = await prisma.settings.findUnique({
      where: { variable: 'telegram_bot_token' }
    });

    // 3. Environment variables (fallback)
    return process.env.TELEGRAM_BOT_TOKEN || null;
  }
}
```

### 2. Provider Pattern Ğ´Ğ»Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ

#### DateRangeProvider (`src/context/DateRangeContext.tsx`)
Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ğ°Ğ¼Ğ¸ Ğ´Ğ°Ñ‚ Ñ Ğ¼ĞµĞ¼Ğ¾Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹:

```typescript
export function DateRangeProvider({ children }: { children: ReactNode }) {
  const [dateRange, setDateRange] = useState<DateRange>(getDefaultDateRange());

  const resetToDefault = useCallback(() => {
    setDateRange(getDefaultDateRange());
  }, []);

  const contextValue = useMemo(() => ({
    dateRange,
    setDateRange,
    resetToDefault,
    formatDateRange,
    formatMobileDateRange,
  }), [dateRange, resetToDefault, formatDateRange, formatMobileDateRange]);

  return (
    <DateRangeContext.Provider value={contextValue}>
      {children}
    </DateRangeContext.Provider>
  );
}
```

**Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ°Ñ€Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**
```typescript
export const getDateRangeParams = (dateRange: DateRange) => {
  if (!dateRange.from || !dateRange.to) return {};
  return {
    from: dateRange.from.toISOString(),
    to: dateRange.to.toISOString(),
  };
};

export const isDateInRange = (date: Date, range: DateRange): boolean => {
  // Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ñ‚ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ·Ğ¾Ğ½
};
```

### 3. Database Connection Management

#### Prisma Singleton (`src/libs/prismaDb.ts`)
ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:

```typescript
const globalForPrisma = global as unknown as { prisma: PrismaClient };

export const prisma =
  globalForPrisma.prisma ||
  new PrismaClient({
    log: process.env.NODE_ENV === "development" ? [] : ["error"],
  });

// ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¹ Ğ² development
if (process.env.NODE_ENV !== "production") globalForPrisma.prisma = prisma;

// Graceful shutdown Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
process.on('beforeExit', async () => {
  await prisma.$disconnect();
});

process.on('SIGINT', async () => {
  await prisma.$disconnect();
  process.exit(0);
});
```

## âš¡ ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

### 1. Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ N+1 Query Problem

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ñ†Ğ¸ĞºĞ»Ğ°Ñ….
**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Batch processing Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸Ğ· analytics API (`src/app/api/products/analytics/route.ts`):**

```typescript
// âŒ ĞŸĞ»Ğ¾Ñ…Ğ¾: N+1 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
// for (const product of products) {
//   const sales = await prisma.order_items.findMany({
//     where: { product_id: product.id }
//   });
// }

// âœ… Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾: Batch Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
const allSalesData = await prisma.order_items.findMany({
  where: {
    product_id: {
      in: products.map((p: any) => p.id) // ĞĞ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²
    },
    orders: {
      paid_at: {
        gte: fromDate,
        lte: new Date()
      }
    }
  },
  include: {
    orders: {
      select: {
        paid_at: true,
        total_amount: true
      }
    }
  }
});

// Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
const salesByProduct = new Map();
allSalesData.forEach((item: any) => {
  const productId = item.product_id;
  if (!salesByProduct.has(productId)) {
    salesByProduct.set(productId, []);
  }
  salesByProduct.get(productId).push(item);
});
```

### 2. Caching Strategy

**ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ĞºÑÑˆ Ñ TTL:**

```typescript
const analyticsCache = {
  get: (key: string) => { /* inmemory cache logic */ },
  set: (key: string, value: any, ttl: number) => { /* cache with expiration */ }
};

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² API Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ½Ñ‹Ğ¼ ĞºĞ»ÑÑ‡Ğ¾Ğ¼
const cacheKey = `products-analytics-${period}-hidden-${showHidden}-cat-${categoryFilter || 'all'}`;
const cachedResult = analyticsCache.get(cacheKey);

if (cachedResult) {
  console.log(`ğŸ“¦ Using cached analytics for period ${period} days`);
  return NextResponse.json(cachedResult);
}

// Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¸ ĞºÑÑˆĞ¸Ñ€ÑƒĞµĞ¼ Ğ½Ğ° 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
const result = await computeAnalytics();
analyticsCache.set(cacheKey, result, 10 * 60 * 1000);
```

### 3. Type-safe BigInt Handling

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** BigInt Ğ½Ğµ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ÑÑ Ğ² JSON.
**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ¯Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² ÑÑ‚Ñ€Ğ¾ĞºĞ¸.

```typescript
const serializedProduct = {
  ...product,
  id: product.id.toString(), // BigInt to String
  price: product.price ? Number(product.price.toString()) : null, // Decimal to Number
  old_price: product.old_price ? Number(product.old_price.toString()) : null,
};
```

## ğŸ¨ UI/UX Architecture Patterns

### 1. Compound Component Pattern

**DateRangePicker** - ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚:

```typescript
// Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ñ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸ĞµĞ¼
export default function DateRangePicker() {
  const [isMobile, setIsMobile] = useState(false);
  
  useEffect(() => {
    const checkIsMobile = () => {
      setIsMobile(window.innerWidth < 640);
    };
    checkIsMobile();
    window.addEventListener('resize', checkIsMobile);
  }, []);

  return (
    <>
      {/* Desktop Calendar */}
      {isOpen && !isMobile && (
        <Calendar {...desktopProps} />
      )}

      {/* Mobile Bottom Sheet */}
      <MobileDatePicker
        isOpen={isOpen && isMobile}
        {...mobileProps}
      />
    </>
  );
}

// ĞŸĞ¾Ğ´ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Calendar Ñ Ğ´Ğ²ÑƒĞ¼Ñ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ğ¼Ğ¸ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
const Calendar: React.FC<CalendarProps> = ({ isMobile = false, ...props }) => {
  if (isMobile) {
    return (
      <div className="px-4">
        {/* Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… */}
        <div className="grid grid-cols-7 gap-1">
          {days.map((date, index) => (
            <button className="p-2.5 text-base rounded-lg min-h-[42px]">
              {date.getDate()}
            </button>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="absolute top-full left-0 mt-2 bg-white border rounded-xl shadow-md">
      {/* Desktop Ğ²ĞµÑ€ÑĞ¸Ñ */}
    </div>
  );
};
```

### 2. Mobile-First Bottom Sheet Pattern

**MobileDatePicker** Ñ touch-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸ÑĞ¼Ğ¸:

```typescript
const MobileDatePicker: React.FC<Props> = ({ isOpen, onClose, ...props }) => {
  const [startY, setStartY] = useState(0);
  const [currentY, setCurrentY] = useState(0);
  const [isDragging, setIsDragging] = useState(false);

  const handleTouchStart = (e: React.TouchEvent) => {
    setStartY(e.touches[0].clientY);
    setIsDragging(true);
  };

  const handleTouchMove = (e: React.TouchEvent) => {
    if (!isDragging) return;
    const y = e.touches[0].clientY;
    const diff = y - startY;
    if (diff > 0) setCurrentY(diff);
  };

  const handleTouchEnd = () => {
    if (currentY > 100) onClose(); // Swipe to dismiss threshold
    setCurrentY(0);
    setIsDragging(false);
  };

  return (
    <div className="fixed inset-0 z-50 flex items-end justify-center">
      <div 
        className="relative w-full bg-white rounded-t-3xl"
        style={{ 
          transform: `translateY(${currentY}px)`,
          transition: isDragging ? 'none' : 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)'
        }}
        onTouchStart={handleTouchStart}
        onTouchMove={handleTouchMove}
        onTouchEnd={handleTouchEnd}
      >
        {/* Bottom sheet content */}
      </div>
    </div>
  );
};
```

### 3. Navigation Tabs Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸

**NavigationTabs** (`src/components/Layouts/header/navigation-tabs/index.tsx`):

```typescript
export function NavigationTabs() {
  const pathname = usePathname();

  return (
    <div className="flex items-center gap-1 overflow-x-auto no-scrollbar">
      {tabs.map((tab, index) => {
        const isActive = pathname === tab.path;
        
        return (
          <motion.div
            key={tab.id}
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: index * 0.05, duration: 0.3 }}
          >
            <Link href={tab.path} className={cn(/* adaptive styles */)}>
              <span className="text-base">{tab.icon}</span>
              <span className="hidden lg:inline">{tab.name}</span>
              
              {/* ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ñ layoutId Ğ´Ğ»Ñ smooth transition */}
              {isActive && (
                <motion.div
                  layoutId="activeHeaderTab"
                  className="absolute inset-0 rounded-lg border-2 border-white/20"
                  transition={{
                    type: "spring",
                    stiffness: 500,
                    damping: 30
                  }}
                />
              )}
            </Link>
          </motion.div>
        );
      })}
    </div>
  );
}
```

## ğŸ§® Business Logic Patterns

### 1. Complex Analytics Engine

**ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ñ€Ğ°ÑÑ‡ĞµÑ‚Ñ‹ Ğ² Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞµ:**

```typescript
// ABC/XYZ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ´Ğ»Ñ ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
function calculateCoefficientOfVariation(values: number[]): number {
  if (values.length < 2) return 0;
  
  const mean = values.reduce((a, b) => a + b, 0) / values.length;
  const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (values.length - 1);
  const stdDev = Math.sqrt(variance);
  
  return mean > 0 ? (stdDev / mean) * 100 : 0;
}

// Ğ¢Ñ€ĞµĞ½Ğ´ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ¾Ğ²
function calculateSalesTrend(dailySales: number[]): 'growing' | 'stable' | 'declining' {
  if (dailySales.length < 7) return 'stable';
  
  const firstHalf = dailySales.slice(0, Math.floor(dailySales.length / 2));
  const secondHalf = dailySales.slice(Math.floor(dailySales.length / 2));
  
  const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
  const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
  
  const growthRate = (secondAvg - firstAvg) / firstAvg;
  
  if (growthRate > 0.1) return 'growing';
  if (growthRate < -0.1) return 'declining';
  return 'stable';
}

// Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ·Ğ°ĞºÑƒĞ¿ĞºĞ°Ğ¼ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ lead time Ğ¸ safety stock
function calculateRecommendedOrder(
  avgDailySales: number,
  currentStock: number,
  inTransit: number,
  leadTimeDays: number = 14,
  safetyStockDays: number = 7
): number {
  const totalAvailable = currentStock + inTransit;
  const demandDuringLeadTime = avgDailySales * leadTimeDays;
  const safetyStock = avgDailySales * safetyStockDays;
  const optimalStock = demandDuringLeadTime + safetyStock;
  
  const recommendedOrder = Math.max(0, optimalStock - totalAvailable);
  
  // ĞĞºÑ€ÑƒĞ³Ğ»ÑĞµĞ¼ Ğ´Ğ¾ Ñ€Ğ°Ğ·ÑƒĞ¼Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ°
  if (recommendedOrder < 10) return Math.ceil(recommendedOrder);
  if (recommendedOrder < 50) return Math.ceil(recommendedOrder / 5) * 5;
  return Math.ceil(recommendedOrder / 10) * 10;
}
```

### 2. Financial Calculations Ñ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ²

**ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸:**

```typescript
// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ expenses
const totalExpenses = await prisma.expenses.findMany({
  where: {
    date: {
      gte: fromDate.toISOString().split('T')[0],
      lte: new Date().toISOString().split('T')[0]
    }
  }
});

const totalExpensesAmount = totalExpenses.reduce((sum, expense) => sum + Number(expense.amount), 0);

// ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¾Ğ±Ñ‰ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ²
const totalSoldItems = await prisma.order_items.aggregate({
  where: {
    orders: {
      paid_at: { gte: fromDate, lte: new Date() }
    }
  },
  _sum: { quantity: true }
});

// Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾
const expensePerUnit = totalSoldItems._sum.quantity > 0 
  ? totalExpensesAmount / totalSoldItems._sum.quantity 
  : 0;

// Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¼Ğ°Ñ€Ğ¶Ğ° Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ²ÑĞµÑ… Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ²
const deliveryCostPerUnit = 350; // â‚½ Ğ·Ğ° ÑˆÑ‚ÑƒĞºÑƒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
const allocatedExpensesPerUnit = expensePerUnit; // ĞŸÑ€Ğ¾Ğ¿Ğ¾Ñ€Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñ‹
const profitPerUnit = avgSalePrice - avgPurchasePrice - deliveryCostPerUnit - allocatedExpensesPerUnit;

const realProfitMargin = avgSalePrice > 0 
  ? ((avgSalePrice - avgPurchasePrice - deliveryCostPerUnit - allocatedExpensesPerUnit) / avgSalePrice) * 100
  : 0;
```

## ğŸŒ API Design Patterns

### 1. Consistent Response Format

**Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ API Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²:**

```typescript
// Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚
return NextResponse.json({
  success: true,
  data: {
    products: sortedAnalytics,
    summary: {
      totalProducts: filteredAnalytics.length,
      criticalStock: criticalCount,
      avgProfitMargin: avgMargin,
      totalExpensesAllocated: totalExpenses,
    },
    period: {
      days: period,
      from: fromDate.toISOString(),
      to: new Date().toISOString()
    }
  }
});

// ĞÑˆĞ¸Ğ±ĞºĞ°
return NextResponse.json(
  { 
    error: 'Internal Server Error', 
    details: error instanceof Error ? error.message : 'Unknown error' 
  }, 
  { status: 500 }
);
```

### 2. Environment-based Configuration

**ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**

```typescript
// Ğ’ TelegramBotService
if (process.env.NODE_ENV === 'development' && message.chat_id !== this.GROUP_CHAT_ID) {
  console.log(`ğŸ”§ DEV MODE: Simulating Telegram message to ${message.chat_id}`);
  return {
    ok: true,
    result: {
      message_id: Math.floor(Math.random() * 10000),
      // mock response
    }
  };
}

// Ğ’ Prisma configuration
new PrismaClient({
  log: process.env.NODE_ENV === "development" ? [] : ["error"],
});
```

### 3. Temporary Auth Bypass Pattern

**Ğ“Ğ¸Ğ±ĞºĞ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸:**

```typescript
export async function GET(request: NextRequest) {
  try {
    // Ğ’Ğ Ğ•ĞœĞ•ĞĞĞ ĞĞ¢ĞšĞ›Ğ®Ğ§Ğ•ĞĞ ĞĞ’Ğ¢ĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
    // const session = await getServerSession();
    // if (!session?.user?.email) {
    //   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    // }

    // API logic continues...
  }
}
```

## ğŸ” Security Patterns

### 1. Multi-layer Token Management

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸ Ñ fallback:**

```typescript
static async getTelegramBotToken(): Promise<string | null> {
  try {
    // 1. ĞšÑÑˆ (performance)
    if (this.isCacheValid() && this.tokenCache.telegram_bot_token) {
      return this.tokenCache.telegram_bot_token;
    }

    // 2. Database (primary source)
    const setting = await prisma.settings.findUnique({
      where: { variable: 'telegram_bot_token' }
    });

    if (setting && setting.value && !this.isMaskedToken(setting.value)) {
      token = setting.value;
    } else {
      // 3. Environment variables (fallback)
      token = process.env.TELEGRAM_BOT_TOKEN || null;
    }

    this.updateCache('telegram_bot_token', token);
    return token;
  } catch (error) {
    // 4. Emergency fallback
    return process.env.TELEGRAM_BOT_TOKEN || null;
  }
}
```

### 2. Token Masking for Security

**ĞœĞ°ÑĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…:**

```typescript
private static maskToken(token: string): string {
  if (token.length < 15) return token;
  return `${token.substring(0, 10)}...${token.slice(-4)}`;
}

private static isMaskedToken(value: string): boolean {
  return value.includes('...') || value.length < 20;
}
```

### 3. Token Validation

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ API:**

```typescript
static async validateToken(token: string): Promise<{
  valid: boolean;
  botInfo?: any;
  error?: string;
}> {
  try {
    const response = await fetch(`https://api.telegram.org/bot${token}/getMe`);
    const result = await response.json();

    if (result.ok) {
      return {
        valid: true,
        botInfo: result.result
      };
    } else {
      return {
        valid: false,
        error: result.description || 'Invalid token'
      };
    }
  } catch (error) {
    return {
      valid: false,
      error: error instanceof Error ? error.message : 'Network error'
    };
  }
}
```

## ğŸ§ª Utility Patterns

### 1. Tailwind CSS Classes Management

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ CSS ĞºĞ»Ğ°ÑÑĞ¾Ğ²:**

```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:
className={cn(
  "base-styles",
  isActive && "active-styles",
  disabled && "disabled-styles",
  customClassName
)}
```

### 2. Date Range Utilities

**Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ´Ğ°Ñ‚Ğ°Ğ¼Ğ¸:**

```typescript
export const getDateRangeParams = (dateRange: DateRange) => {
  if (!dateRange.from || !dateRange.to) {
    return {};
  }

  return {
    from: dateRange.from.toISOString(),
    to: dateRange.to.toISOString(),
  };
};

export const isDateInRange = (date: Date, range: DateRange): boolean => {
  if (!range.from || !range.to) return true;
  
  const checkDate = new Date(date);
  const fromDate = new Date(range.from);
  const toDate = new Date(range.to);
  
  // Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ñ‚
  checkDate.setHours(0, 0, 0, 0);
  fromDate.setHours(0, 0, 0, 0);
  toDate.setHours(23, 59, 59, 999);
  
  return checkDate >= fromDate && checkDate <= toDate;
};
```

## ğŸ“Š Database Patterns

### 1. Hierarchical Data (Ancestry Pattern)

**Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ² PostgreSQL:**

```sql
-- Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· ancestry Ğ¿Ğ¾Ğ»Ğµ
-- ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "123" (ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ) -> "123/456" (Ğ¿Ğ¾Ğ´ĞºategĞ¾Ñ€Ğ¸Ñ) -> "123/456/789" (Ñ‚Ğ¾Ğ²Ğ°Ñ€)

-- Ğ’ API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´ĞµÑ‚ĞµĞ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸:
const expectedAncestry = parent.ancestry ? `${parent.ancestry}/${productId}` : `${productId}`;

const products = await prisma.products.findMany({
  where: {
    ancestry: expectedAncestry, // Ğ¢Ğ¾Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ´ĞµÑ‚ĞµĞ¹
    deleted_at: null,
    show_in_webapp: true,
  }
});
```

### 2. Soft Delete Pattern

**ĞœÑĞ³ĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹:**

```typescript
// Ğ’ÑĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ÑÑ‚ deleted_at Ğ¿Ğ¾Ğ»Ğµ
const whereConditions: any = {
  deleted_at: null, // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
  ancestry: {
    contains: '/' // Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹, Ğ½Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
  }
};

// Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
if (!showHidden) {
  whereConditions.is_visible = true;
}
```

### 3. BigInt and Decimal Handling

**ĞšĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ BigInt Ğ¸ Decimal Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸ Prisma:**

```typescript
// Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ BigInt ID
const newMessage = await prisma.messages.create({
  data: {
    text: message.text,
    tg_id: from ? BigInt(from.id) : null, // Ğ¯Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² BigInt
    tg_msg_id: BigInt(message.message_id),
    created_at: new Date(message.date * 1000), // Unix timestamp Ğ² Ğ¼Ğ¸Ğ»Ğ»Ğ¸ÑĞµĞºÑƒĞ½Ğ´Ñ‹
  },
});

// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ Decimal Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸
await prisma.exchange_rates.create({
  data: {
    rate: new Decimal(rate), // Ğ¯Ğ²Ğ½Ğ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Decimal
    rateWithBuffer: new Decimal(rateWithBuffer),
    bufferPercent: new Decimal(bufferPercent),
  },
});

// Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ JSON Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
const serializedProduct = {
  ...product,
  id: product.id.toString(), // BigInt -> String
  price: product.price ? Number(product.price.toString()) : null, // Decimal -> Number
};
```

## ğŸš€ Deployment & Infrastructure Patterns

### 1. Environment Configuration

```typescript
// ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ€ĞµĞ´
const S3Config = {
  endpoint: process.env.S3_ENDPOINT || 'https://s3.ru1.storage.beget.cloud',
  bucket: process.env.S3_BUCKET || '2c11548b454d-eldar-agency',
  region: process.env.AWS_REGION || 'ru-1',
};

// Database connection Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼Ğ¸
DATABASE_URL="postgresql://admin:admin@89.169.38.127:5433/webapp_production?sslmode=prefer&connection_limit=5&pool_timeout=20"
```

### 2. Graceful Error Handling

```typescript
export async function GET(request: NextRequest) {
  try {
    console.log('ğŸ“Š Starting analytics...');
    
    // Main logic here
    
    console.log('âœ… Analytics completed successfully');
    return NextResponse.json(result);
  } catch (error) {
    console.error('âŒ Analytics API Error:', error);
    console.error('Error stack:', error instanceof Error ? error.stack : 'No stack trace');
    
    return NextResponse.json(
      { 
        error: 'Internal Server Error', 
        details: error instanceof Error ? error.message : 'Unknown error' 
      }, 
      { status: 500 }
    );
  }
}
```

## ğŸ“ˆ Performance Monitoring

### 1. Structured Logging

```typescript
// ĞšĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
console.log('ğŸ“Š Products API: Starting advanced analytics...');
console.log(`ğŸ”„ Computing fresh analytics for period ${period} days`);
console.log(`ğŸ’± Exchange rate TRY: ${exchangeRate}`);
console.log(`ğŸ“¦ Using cached analytics for period ${period} days`);
console.log(`âœ… Analytics completed for ${analytics.length} products and cached`);
```

### 2. Performance Metrics

```typescript
// Ğ—Ğ°Ğ¼ĞµÑ€Ñ‹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
const startTime = Date.now();

// Expensive operation
const analytics = await computeComplexAnalytics();

const duration = Date.now() - startTime;
console.log(`â±ï¸ Analytics computation took ${duration}ms for ${products.length} products`);
```

## ğŸ”® Extensibility Patterns

### 1. Service Registry Pattern

Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ ÑĞ»ĞµĞ´ÑƒÑÑ‚ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ğ¾Ğ¼Ñƒ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑƒ, Ñ‡Ñ‚Ğ¾ ÑƒĞ¿Ñ€Ğ¾Ñ‰Ğ°ĞµÑ‚ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ:

```typescript
// ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
interface ServiceBase {
  static async initialize(): Promise<void>;
  static async healthCheck(): Promise<boolean>;
}

// Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
export class NewExternalService implements ServiceBase {
  static async initialize() { /* setup */ }
  static async healthCheck() { /* validation */ }
  
  static async specificMethod() { /* business logic */ }
}
```

### 2. Plugin Architecture

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:

```typescript
// Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· settings Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ
const featureFlag = await prisma.settings.findUnique({
  where: { variable: 'enable_new_feature' }
});

if (featureFlag?.value === 'true') {
  // Ğ’ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
}
```

---

## ğŸ† Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞ¼Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğº ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ñ… Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹:

### âœ… Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹:

1. **ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ñ‡ĞµÑ‚ĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ»Ğ¾ÑĞ¼Ğ¸
2. **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
3. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ñ‹Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼Ğ¸
4. **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - service layer architecture Ğ¸ dependency injection
5. **Ğ¢Ğ¸Ğ¿Ğ¾Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - TypeScript + Prisma Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²
6. **UX** - Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ñ Ğ¿Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼Ğ¸ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸
7. **Maintainability** - ĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ´Ğ°

### ğŸš€ ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

- **Service Classes** Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¹ Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ API
- **Context Providers** Ñ Ğ¼ĞµĞ¼Ğ¾Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ Ğ´Ğ»Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
- **Compound Components** Ğ´Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… UI ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- **Batch Processing** Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğº Ğ‘Ğ”
- **Multi-layer Fallback** Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸
- **Environment-based Configuration** Ğ´Ğ»Ñ Ğ³Ğ¸Ğ±ĞºĞ¾ÑÑ‚Ğ¸ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ

Ğ”Ğ°Ğ½Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ»ÑƒĞ¶Ğ¸Ñ‚ÑŒ Ñ€ĞµÑ„ĞµÑ€ĞµĞ½ÑĞ¾Ğ¼ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… full-stack Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ğ½Ğ° Next.js Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².